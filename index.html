Ø§Ù„ØªØ¹Ø¯ÙŠÙ„  ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ø·Ø§Ù„Ø¨ 
Ù„Ø§ÙŠÙˆØ¬Ø¯ Ø§Ù„ØµÙˆØª Ø§Ù„ØªØ±Ø­ÙŠØ¨ÙŠ ÙˆÙ„Ø§ ØµÙˆØª Ø§Ù„Ù†Ù‚Ø± 
Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø© ØŸ ÙŠØ­Ø°Ù Ø§Ù„Ù†Øµ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ ÙÙŠÙ‡ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ù„Ù„Ø¯Ø®ÙˆÙ„ ØªØ¹Ø¯ÙŠÙ„ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ„Ø§Ù… Ø¨Ø­ÙŠØ« ÙŠÙƒÙˆÙ† Ù…Ù†Ø§Ø³Ø¨ 
ØªØ±Ù‚ÙŠÙ‡ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ø§Ø¨Ø¯ 
Ø§Ù† ØªÙƒÙˆÙ† 
Ø¨Ø±ÙˆÙ†Ø²ÙŠ 10 Ø¢Ù„Ø§Ù ÙˆØ£Ù‚Ù„ 
ÙØ¶ÙŠ Ù…Ù† 11 Ø¢Ù„Ø§Ù Ø¥Ù„Ù‰ Ù¡Ù¥ Ø£Ù„Ù 
Ø°Ù‡Ø¨ÙŠ Ù…Ù† Ù¡Ù¦ Ø£Ù„Ù Ø¥Ù„Ù‰ 20 Ø§Ù„Ù 
Ù…Ø§Ø³ÙŠ Ù…Ù† 21 Ø£Ù„Ù Ø¥Ù„Ù‰ 30 Ø§Ù„Ù 
Ø§Ù„Ù…Ø§Ø³ÙŠÙ‘ Ø§ÙƒØ«Ø± Ù…Ù† 30 Ø£Ù„Ù

ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© : Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª ÙŠØ­Ø°Ù 
ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨ pdf  Ø§Ù…Ø§Ù‹ Ø§Ù† ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¶ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙØ§Ø±Øº Ø£Ùˆ Ù†Ø§Ù‚Øµ ÙˆÙ„Ø§ÙŠÙˆØ¬Ø¯ Ø¨Ù‡ Ø§Ù„ØªÙˆÙ‚ÙŠØ¹ ÙˆÙ„Ø§ Ø§Ù„Ø®ØªÙ…


Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙÙŠ ØµÙØ­Ø© Ø§Ù„ÙØµÙˆÙ„ Ù„Ù„Ù…Ø¹Ù„Ù…Ø©
Ù„Ø§ÙŠÙˆØ¬Ø¯ Ø²Ø±  Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø£Ù…Ù‡Ø§Øª ØªØ­Ø¯ÙŠØ¯ Ø¹Ù…Ù„ÙŠØ© ÙˆØ§Ø±Ø³Ù„Ù‡Ø§ Ù„Ù„ÙˆØªØ³Ø§Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ 
Ù†Øµ Ø±Ø³Ø§Ù„Ù‡ Ø§Ø³ØªØ±Ø¬Ø§Ø¹ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…  ØºÙŠØ± Ù…Ø±ØªØ¨ 




 



from pathlib import Path, PurePosixPath
path = Path("/mnt/data/index_new.html")
html = """<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€“ Ø§Ù„Ù…ØµØ±ÙÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…Ø© Ø³Ø§Ø±Ø© Ø­Ù‚ÙˆÙŠ</title>

  <style>
    :root{
      --navy:#00205B; --rajhi:#0055A4; --sky:#EAF3FB; --sky2:#CFE6F7; --beige:#FAF9F7;
      --green:#2e7d32; --red:#b00020; --text:#1b1f23;
      --card:#ffffff;
      --line:rgba(0,0,0,.08);
      --shadow:0 14px 34px rgba(0,0,0,.10);
      --shadow2:0 8px 18px rgba(0,0,0,.08);
      --muted:rgba(255,255,255,.75);
      --glass:rgba(255,255,255,.10);
    }
    *{box-sizing:border-box;font-family:Tahoma,Arial,sans-serif}
    body{margin:0;background:linear-gradient(180deg,#061a3d 0%, #071f4a 24%, var(--beige) 24%);color:var(--text)}
    a{color:inherit}
    .hidden{display:none !important}

    /* Topbar */
    .topbar{
      position:sticky;top:0;z-index:2000;
      background:linear-gradient(90deg,#061c45,#07336f);
      color:#fff;padding:12px 14px;display:flex;align-items:center;gap:12px;
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .topbar .titles{flex:1;text-align:center;line-height:1.35}
    .topbar .t1{font-weight:900;font-size:16px;letter-spacing:.2px}
    .topbar .t2{font-size:12px;opacity:.92}
    .logo{height:54px;width:auto;background:rgba(255,255,255,.85);border-radius:12px;padding:6px}
    .container{max-width:1040px;margin:14px auto;padding:0 12px}
    .card{background:var(--card);border-radius:16px;padding:14px;margin:10px 0;box-shadow:var(--shadow2);border:1px solid var(--line)}
    .card.soft{background:linear-gradient(180deg,#f7fbff,#ffffff)}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    .col{flex:1;min-width:170px}
    input,select{width:100%;padding:12px 12px;border-radius:12px;border:1px solid rgba(0,0,0,.18);font-size:14px;outline:none;background:#fff}
    input:focus,select:focus{border-color:rgba(0,85,164,.55);box-shadow:0 0 0 3px rgba(0,85,164,.12)}
    button{border:0;border-radius:12px;padding:12px 12px;cursor:pointer;font-size:14px;font-weight:800}
    .btn{background:var(--rajhi);color:#fff}
    .btn2{background:var(--sky2);color:#003;font-weight:800}
    .btn3{background:#eef6fb;color:#003;font-weight:800}
    .btnRed{background:var(--red);color:#fff}
    .whatsapp-btn{background:#25D366 !important;color:#fff !important;font-weight:900;}
    .whatsapp-btn:hover{filter:brightness(.97)}
    .small{font-size:12px;color:#6b7280}
    hr{border:0;border-top:1px solid rgba(0,0,0,.08);margin:12px 0}

    /* Footer */
    .footerBar{
      max-width:1040px;margin:14px auto 26px auto;padding:0 12px;
      color:rgba(255,255,255,.92)
    }
    .footerLinks{
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
      padding:10px 12px;border-radius:14px;border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);backdrop-filter: blur(10px);
    }
    .footerLinks a{
      text-decoration:none;
      font-weight:900;font-size:13px;
      opacity:.95;
      padding:8px 10px;border-radius:12px;
      border:1px solid rgba(255,255,255,.10);
      background:rgba(0,0,0,.08);
    }
    .footerNote{
      margin-top:10px;text-align:center;font-weight:900;letter-spacing:.2px;
    }

    /* Modal / Drawer */
    .modal{position:fixed;inset:0;background:rgba(0,0,0,.50);display:none;align-items:center;justify-content:center;padding:18px;z-index:9999}
    .modalBox{background:#fff;border-radius:18px;max-width:760px;width:100%;padding:16px}
    .modalHead{display:flex;justify-content:space-between;align-items:center;gap:10px}
    .modalHead h3{margin:0;color:var(--navy);font-weight:900}
    .xBtn{background:#eef2f7;border:1px solid rgba(0,0,0,.10);padding:10px 12px;border-radius:12px;font-weight:900}
    .modalBody{margin-top:10px;line-height:1.85;color:#111827}
    .modalActions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .modalActions a,.modalActions button{flex:1;text-decoration:none}

    /* Start */
    #startOverlay{
      position:fixed;inset:0;z-index:9998;
      display:flex;align-items:center;justify-content:center;padding:18px;
      background: radial-gradient(circle at top, #0b2a66 0%, #061a3d 55%, #04112a 100%);
    }
    .startBox{
      width:min(720px,100%);
      border-radius:22px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(255,255,255,.08);
      backdrop-filter: blur(12px);
      box-shadow:0 18px 60px rgba(0,0,0,.40);
      overflow:hidden;
    }
    .startTop{
      display:flex;justify-content:space-between;align-items:center;
      padding:14px 14px;color:#fff;
      background:linear-gradient(90deg,rgba(255,255,255,.10),rgba(0,0,0,.08));
      border-bottom:1px solid rgba(255,255,255,.12);
    }
    .pill{display:inline-block;background:rgba(255,255,255,.16);border:1px solid rgba(255,255,255,.18);
      color:#fff;padding:6px 12px;border-radius:999px;font-size:12px;font-weight:900}
    .startBody{padding:18px}
    .heroRow{display:flex;gap:14px;align-items:center;justify-content:center;flex-wrap:wrap}
    .heroLogo{
      width:94px;height:94px;border-radius:18px;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.25);
      overflow:hidden;display:flex;align-items:center;justify-content:center;
      box-shadow:0 14px 34px rgba(0,0,0,.25);
    }
    .heroLogo img{width:100%;height:100%;object-fit:cover}
    .heroText{color:#fff;text-align:right}
    .heroText .ar{font-weight:1000;font-size:22px;letter-spacing:.2px}
    .heroText .en{font-weight:900;opacity:.90;margin-top:2px}
    .heroText .name{font-weight:900;opacity:.92;margin-top:6px;font-size:13px}
    .startMsg{
      margin-top:14px;
      padding:14px;border-radius:18px;
      background:rgba(0,0,0,.14);
      border:1px solid rgba(255,255,255,.14);
      color:#fff;line-height:1.8
    }
    .startActions{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .startActions button{flex:1}
    .ghostBtn{background:rgba(255,255,255,.12);color:#fff;border:1px solid rgba(255,255,255,.18)}
    .ghostBtn:hover{filter:brightness(1.02)}

    /* Auth pages */
    .authWrap{display:flex;justify-content:center}
    .authCard{
      width:min(520px,100%);
      border-radius:22px;
      background:rgba(255,255,255,.94);
      border:1px solid rgba(255,255,255,.40);
      box-shadow:0 18px 60px rgba(0,0,0,.20);
      overflow:hidden;
    }
    .authHead{
      padding:14px 14px;
      background:linear-gradient(90deg,#061c45,#07336f);
      color:#fff;
    }
    .authHead .t{font-weight:1000;font-size:18px}
    .authHead .s{opacity:.92;font-weight:800;font-size:12px;margin-top:4px}
    .authBody{padding:14px}
    .field{
      display:flex;align-items:center;gap:10px;
      border:1px solid rgba(0,0,0,.14);
      border-radius:14px;padding:10px 12px;background:#fff;
      margin:10px 0;
    }
    .field svg{flex:0 0 auto;opacity:.9}
    .field input{border:0;padding:4px 0;border-radius:0;outline:none}
    .eyeBtn{background:#eef2f7;border:1px solid rgba(0,0,0,.10);padding:10px 12px;border-radius:12px;font-weight:900}
    .forgotRow{display:flex;justify-content:space-between;align-items:center;gap:10px;flex-wrap:wrap;margin-top:6px}
    .forgotRow a{color:#0b5bb5;font-weight:900;text-decoration:none}

    /* Bank layout */
    .tabs{display:flex;gap:8px;justify-content:center;flex-wrap:wrap;margin:10px 0}
    .tab{background:#e9f4fb;color:#003;padding:8px 12px;border-radius:999px;cursor:pointer;font-size:14px;font-weight:900;border:1px solid rgba(0,0,0,.06)}
    .tab.active{background:var(--rajhi);color:#fff}

    .grid2{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media(max-width:820px){.grid2{grid-template-columns:1fr}}

    .badge{display:inline-block;padding:5px 10px;border-radius:999px;font-size:12px;font-weight:900}
    .badge.on{background:#dff4e3;color:var(--green)}
    .badge.off{background:#fde2e2;color:var(--red)}

    /* Classic geometric card (inspired by classic bank geometric style; no logos) */
    .bankCard{
      position:relative;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(0,0,0,.10);
      background:linear-gradient(180deg,#ffffff,#f5f7fb);
      box-shadow:0 16px 40px rgba(0,0,0,.14);
      min-height:210px;
    }
    .bankCard:before{
      content:"";
      position:absolute;inset:-40px;
      background:
        radial-gradient(circle at 12% 18%, rgba(0,85,164,.28) 0%, rgba(0,85,164,0) 45%),
        radial-gradient(circle at 88% 72%, rgba(0,32,91,.22) 0%, rgba(0,32,91,0) 48%),
        linear-gradient(135deg, rgba(0,0,0,.00) 0%, rgba(0,0,0,.03) 100%);
      pointer-events:none;
    }
    .geo{
      position:absolute;inset:0;opacity:.70;pointer-events:none;
      background:
        linear-gradient(140deg, rgba(0,85,164,.16) 0 2px, transparent 2px 100%),
        linear-gradient(40deg, rgba(0,32,91,.14) 0 2px, transparent 2px 100%);
      background-size: 190px 190px, 240px 240px;
      mix-blend-mode:multiply;
    }
    .bankCard .inner{position:relative;padding:16px}
    .bankBrand{
      display:flex;justify-content:space-between;align-items:flex-start;gap:10px;
      color:#0b2a66;
    }
    .bankBrand .b1{font-weight:1000;font-size:14px}
    .bankBrand .b2{font-weight:900;font-size:11px;opacity:.8;margin-top:2px}
    .chip{
      width:54px;height:40px;border-radius:10px;
      background:linear-gradient(180deg,#f4d48a,#d7a841);
      border:1px solid rgba(0,0,0,.18);
      box-shadow:0 10px 18px rgba(0,0,0,.12);
      position:relative;
    }
    .chip:before,.chip:after{
      content:"";position:absolute;left:8px;right:8px;height:1px;background:rgba(0,0,0,.18)
    }
    .chip:before{top:14px}
    .chip:after{top:26px}
    .cardNum{
      margin-top:18px;
      font-weight:1000;
      letter-spacing:2px;
      font-size:18px;
      color:#0b2a66;
      direction:ltr;
      text-align:left;
    }
    .cardMeta{
      margin-top:12px;
      display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;
      color:#0b2a66;
    }
    .metaItem{font-size:12px;font-weight:900}
    .metaItem span{display:block;font-size:10px;opacity:.75;font-weight:900;margin-bottom:2px}
    .holder{
      margin-top:10px;
      font-weight:1000;color:#0b2a66;font-size:13px
    }
    .cardHint{
      margin-top:10px;
      font-size:11px;font-weight:900;color:rgba(11,42,102,.78)
    }

    /* Student account tabs */
    .miniTabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .miniTab{flex:1;min-width:150px;background:#f0f7ff;border:1px solid rgba(0,0,0,.06);
      border-radius:14px;padding:10px;cursor:pointer;font-weight:1000;display:flex;align-items:center;gap:10px;justify-content:center}
    .miniTab.active{background:linear-gradient(90deg,#0b2a66,#0b5bb5);color:#fff}
    .miniPane{display:none}
    .miniPane.active{display:block}

    .kpis{display:grid;grid-template-columns:repeat(4,1fr);gap:10px;margin-top:10px}
    .kpi{border-radius:16px;background:linear-gradient(180deg,#ffffff,#f7fbff);
      border:1px solid rgba(0,0,0,.06);padding:10px;box-shadow:0 10px 18px rgba(0,0,0,.06)}
    .kpi .k{font-size:11px;color:#6b7280;font-weight:1000}
    .kpi .v{font-size:18px;font-weight:1000;color:#0b2a66;margin-top:4px}
    @media(max-width:860px){.kpis{grid-template-columns:repeat(2,1fr)}}

    /* Statement */
    .tableWrap{overflow:auto;border-radius:14px;background:#f7fbff;border:1px solid #e6eef7}
    table{width:100%;border-collapse:collapse;min-width:760px}
    th,td{padding:10px;border-bottom:1px solid #e6eef7;text-align:center;font-size:13px;white-space:nowrap}
    th{background:#eef6ff;color:#0b2a66;font-weight:1000}
    tr:last-child td{border-bottom:none}

    /* Onboarding */
    #onboardOverlay{
      position:fixed; inset:0; z-index:9997;
      background: radial-gradient(circle at top, #0b2a66 0%, #061a3d 55%, #04112a 100%);
      display:none; align-items:center; justify-content:center; padding:18px;
    }
    .onbBox{
      width:min(720px, 100%);
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      border-radius:22px;
      box-shadow:0 18px 60px rgba(0,0,0,.45);
      overflow:hidden;
      backdrop-filter: blur(12px);
    }
    .onbTop{
      display:flex; justify-content:space-between; align-items:center;
      padding:12px 14px;
      background:rgba(0,0,0,.18);
      color:#fff;
      font-weight:1000;
    }
    .onbSkip{
      background:rgba(255,255,255,.16);
      color:#fff;border-radius:999px;padding:8px 12px;cursor:pointer;
      border:1px solid rgba(255,255,255,.18);font-weight:1000
    }
    .onbBody{padding:14px}
    .onbViewport{
      overflow:hidden;width:100%;position:relative;direction:ltr;
      /* Ù…Ù†Ø¹ Ø³Ø­Ø¨ Ø§Ù„Ù†Øµ */
      user-select:none; -webkit-user-select:none;
      -webkit-touch-callout:none;
      touch-action:pan-y;
    }
    .onbTrack{display:flex;width:300%;transition:transform .45s ease}
    .onbSlide{
      flex:0 0 100%;
      min-height:280px;
      border-radius:20px;
      padding:26px 18px;
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;
      direction:rtl;
      background:linear-gradient(180deg, rgba(255,255,255,.10), rgba(0,0,0,.10));
      border:1px solid rgba(255,255,255,.16);
      box-shadow:0 14px 34px rgba(0,0,0,.22);
    }
    .onbArt{
      width:92px;height:92px;border-radius:22px;
      display:flex;align-items:center;justify-content:center;
      background:rgba(255,255,255,.92);
      border:1px solid rgba(255,255,255,.25);
      box-shadow:0 12px 26px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .onbArt svg{width:62px;height:62px}
    .onbTitle{font-size:18px;font-weight:1000;color:#fff;margin-top:12px}
    .onbText{font-size:14px;line-height:1.95;margin-top:8px;color:rgba(255,255,255,.92);max-width:560px}
    .onbDots{display:flex;gap:8px;justify-content:center;margin-top:10px}
    .onbDot{width:9px;height:9px;border-radius:999px;background:rgba(255,255,255,.35)}
    .onbDot.active{background:#fff}
    .onbControls{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .onbControls button{flex:1}

    /* PDF paper */
    #pdfTemp{position:fixed;left:-9999px;top:-9999px;width:794px;} /* A4-ish width px */
    .pdfPaper{background:#fff;border:1px solid #e5e7eb;border-radius:18px;padding:14px}
    .pdfHead{display:flex;justify-content:space-between;align-items:center;gap:12px}
    .pdfBrand{display:flex;align-items:center;gap:10px}
    .pdfLogo{
      width:56px;height:56px;border-radius:14px;overflow:hidden;border:1px solid rgba(0,0,0,.10);
      background:#fff;display:flex;align-items:center;justify-content:center
    }
    .pdfLogo img{width:100%;height:100%;object-fit:cover}
    .pdfTitle{font-weight:1000;color:#0b2a66}
    .pdfSub{font-size:12px;color:#6b7280;font-weight:900;margin-top:2px}
    .seal{
      width:86px;height:86px;border-radius:999px;
      border:2px dashed rgba(11,42,102,.55);
      display:flex;align-items:center;justify-content:center;
      color:#0b2a66;font-weight:1000;font-size:10px;text-align:center;line-height:1.2;
      transform:rotate(-8deg);
    }
    .sigRow{display:flex;justify-content:space-between;align-items:flex-end;gap:12px;margin-top:12px}
    .sigBox{border-top:1px dashed #9ca3af;padding-top:8px;font-size:12px;color:#111827;font-weight:900;min-width:240px}
  </style>
</head>

<body>
  <div class="topbar">
    <img class="logo" src="school-logo.png" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ù…Ø¯Ø±Ø³Ø©">
    <div class="titles">
      <div class="t1">Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€“ Ø§Ù„Ù…ØµØ±ÙÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…Ø© Ø³Ø§Ø±Ø© Ø­Ù‚ÙˆÙŠ</div>
      <div class="t2">Ù…Ø¯Ø±Ø³Ø© Ø±ÙˆØ§Ø¯ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£Ù‡Ù„ÙŠØ©</div>
    </div>
    <div style="width:54px"></div>
  </div>

  <!-- ===== Start ===== -->
  <div id="startOverlay">
    <div class="startBox">
      <div class="startTop">
        <div class="pill" id="connPill">...Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù†Ø¸Ø§Ù…...</div>
        <div class="pill" id="modePill">ÙˆØ¶Ø¹: Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</div>
      </div>
      <div class="startBody">
        <div class="heroRow">
          <div class="heroLogo"><img src="logo.png" alt="logo"></div>
          <div class="heroText">
            <div class="ar">Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
            <div class="en">Math Bank</div>
            <div class="name">Ø£. Ø³Ø§Ø±Ø© Ø­Ù‚ÙˆÙŠ</div>
          </div>
        </div>

        <div class="startMsg" id="startMsg">
          Ø¬Ø§Ù‡Ø²ÙŠÙ† Ù†Ø¨Ø¯Ø£ØŸ ğŸŒ¿<br>
          Ù†Ø¸Ø§Ù… Ø¨Ù†ÙƒÙŠ Ù…Ø¯Ø±Ø³ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø§Ù„Ø±ØµÙŠØ¯ØŒ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§ØªØŒ Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§ØªØŒ ÙˆØ§Ù„Ø­ÙˆØ§ÙØ².
        </div>

        <div class="startActions">
          <button class="btn" onclick="startApp()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¢Ù†</button>
          <button class="ghostBtn" onclick="openHelp()">Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Onboarding ===== -->
  <div id="onboardOverlay" aria-hidden="true">
    <div class="onbBox">
      <div class="onbTop">
        <div>ØªØ¹Ø±ÙŠÙ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
        <button class="onbSkip" onclick="finishOnboarding()">ØªØ®Ø·ÙŠ</button>
      </div>

      <div class="onbBody">
        <div class="onbViewport" id="onbViewport">
          <div class="onbTrack" id="onbTrack">
            <div class="onbSlide">
              <div class="onbArt" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M3 10.5L12 5l9 5.5" stroke="#00205B" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M5 10.5V19h14v-8.5" stroke="#0055A4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                  <path d="M8 19v-6M12 19v-6M16 19v-6" stroke="#00205B" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="onbTitle">Ù…Ù†ØµØ© Ù…ØªØ§Ø¨Ø¹Ø© Ø³Ù„ÙˆÙƒÙŠØ© ÙˆØªØ¹Ù„ÙŠÙ…ÙŠØ©</div>
              <div class="onbText">ÙŠÙˆØ«Ù‚ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„ØªØ­ÙÙŠØ²ÙŠØ© ÙˆØ§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ù„Ù„Ø·Ø§Ù„Ø¨/Ù€Ø© ÙˆÙŠØ±ØµØ¯ Ø§Ù„Ø±ØµÙŠØ¯ ÙˆØªØ§Ø±ÙŠØ® Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø¨ØµÙˆØ±Ø© Ù…Ù†Ø¸Ù…Ø©.</div>
            </div>

            <div class="onbSlide">
              <div class="onbArt" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M7 3h7l3 3v15H7V3Z" stroke="#00205B" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M14 3v4h4" stroke="#0055A4" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M9 12h6M9 16h6" stroke="#00205B" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <div class="onbTitle">Ø¥Ø­ØµØ§Ø¡Ø§Øª ÙˆØªÙ‚Ø§Ø±ÙŠØ± PDF</div>
              <div class="onbText">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ + Ù…Ø¤Ø´Ø±Ø§Øª Ø£Ø¯Ø§Ø¡ + ØªÙ‚Ø±ÙŠØ± Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø§Ø­ØªØ±Ø§ÙÙŠ Ø¨Ø®ØªÙ… ÙˆØªÙˆÙ‚ÙŠØ¹ØŒ Ù„Ø¯Ø¹Ù… Ù…ØªØ§Ø¨Ø¹Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ÙˆØ§Ù„Ù…Ø¯Ø±Ø³Ø©.</div>
            </div>

            <div class="onbSlide">
              <div class="onbArt" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none">
                  <path d="M12 3l7 4v6c0 5-3 8-7 8s-7-3-7-8V7l7-4Z" stroke="#00205B" stroke-width="2" stroke-linejoin="round"/>
                  <path d="M9.5 12l1.8 1.8L15 10" stroke="#0055A4" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
              </div>
              <div class="onbTitle">Ø¬ÙˆØ§Ø¦Ø² ÙˆØªØ±Ù‚ÙŠØ§Øª Ø­Ø³Ø§Ø¨</div>
              <div class="onbText">Ù†Ø¸Ø§Ù… Ø¯Ø±Ø¬Ø§Øª Ø­Ø³Ø§Ø¨Ø§Øª (Ø¨Ø±ÙˆÙ†Ø²ÙŠ/ÙØ¶ÙŠ/Ø°Ù‡Ø¨ÙŠ/Ù…Ø§Ø³ÙŠ/Ø£Ù„Ù…Ø§Ø³ÙŠ) + Ø¬ÙˆØ§Ø¦Ø² Ù…ÙˆØ³Ù…ÙŠØ© Ù„ØªØ­ÙÙŠØ² Ø§Ù„Ø³Ù„ÙˆÙƒ ÙˆØ§Ù„ØªÙØ§Ø¹Ù„.</div>
            </div>
          </div>
        </div>

        <div class="onbDots" id="onbDots">
          <div class="onbDot active"></div>
          <div class="onbDot"></div>
          <div class="onbDot"></div>
        </div>

        <div class="onbControls">
          <button class="btn3" onclick="onbPrev()">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
          <button class="btn" onclick="onbNext()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Modal ===== -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modalBox">
      <div class="modalHead">
        <h3 id="mTitle"></h3>
        <button class="xBtn" onclick="closeModal()">âœ•</button>
      </div>
      <div class="modalBody" id="mBody"></div>
      <div class="modalActions" id="mActions"></div>
    </div>
  </div>

  <!-- ===== Auth (Teacher) ===== -->
  <div id="teacherLoginPage" class="hidden">
    <div class="container authWrap">
      <div class="authCard">
        <div class="authHead">
          <div class="t">Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ø¹ÙˆØ¯ØªÙƒ ğŸ‘‹</div>
          <div class="s">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø¥Ù„Ù‰ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
        </div>
        <div class="authBody">
          <div class="field">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M4 20h16" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 20v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <circle cx="12" cy="8" r="3" stroke="#0b5bb5" stroke-width="2"/>
            </svg>
            <input id="tu" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨ / Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…" autocomplete="username"/>
          </div>

          <div class="field">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M7 10V8a5 5 0 0 1 10 0v2" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <rect x="6" y="10" width="12" height="10" rx="2" stroke="#0b5bb5" stroke-width="2"/>
            </svg>
            <input id="tp" type="password" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" autocomplete="current-password"/>
            <button class="eyeBtn" type="button" onclick="togglePass('tp',this)">ğŸ‘ï¸</button>
          </div>

          <div class="forgotRow">
            <a href="javascript:void(0)" onclick="forgotTeacher()">ØªØ°ÙƒØ±Ù†ÙŠ / Ù†Ø³ÙŠØª ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ</a>
            <span class="small">Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠ: teacher / 12345</span>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn col" onclick="teacherLogin()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
            <button class="btn3 col" onclick="goPublic()">Ø±Ø¬ÙˆØ¹</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Auth (Student) ===== -->
  <div id="studentLoginPage" class="hidden">
    <div class="container authWrap">
      <div class="authCard">
        <div class="authHead">
          <div class="t">Ø£Ù‡Ù„Ù‹Ø§ Ø¨Ø¹ÙˆØ¯ØªÙƒ ğŸ‘‹</div>
          <div class="s">Ø¨ÙˆØ§Ø¨Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ Ø¥Ù„Ù‰ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
        </div>
        <div class="authBody">
          <div id="stuLocked" class="small hidden" style="color:var(--red);font-weight:1000"></div>

          <div class="field">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M4 20h16" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <path d="M6 20v-2a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v2" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <circle cx="12" cy="8" r="3" stroke="#0b5bb5" stroke-width="2"/>
            </svg>
            <input id="stuName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø© ÙƒÙ…Ø§ Ù‡Ùˆ Ù…Ø³Ø¬Ù„" autocomplete="username"/>
          </div>

          <div class="field">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none">
              <path d="M7 10V8a5 5 0 0 1 10 0v2" stroke="#0b2a66" stroke-width="2" stroke-linecap="round"/>
              <rect x="6" y="10" width="12" height="10" rx="2" stroke="#0b5bb5" stroke-width="2"/>
            </svg>
            <input id="stuPin" type="password" placeholder="Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (PIN)" autocomplete="current-password"/>
            <button class="eyeBtn" type="button" onclick="togglePass('stuPin',this)">ğŸ‘ï¸</button>
          </div>

          <div class="forgotRow">
            <a href="javascript:void(0)" id="forgotPinLink">Ù†Ø³ÙŠØª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠØŸ</a>
            <span class="small">Ø§Ø·Ù„Ø¨Ù‡ Ù…Ù† ÙˆÙ„ÙŠ Ø£Ù…Ø±Ùƒ Ø£Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</span>
          </div>

          <div class="row" style="margin-top:12px">
            <button class="btn col" onclick="studentLogin()">Ø¯Ø®ÙˆÙ„</button>
            <button class="btn3 col" onclick="goPublic()">Ø±Ø¬ÙˆØ¹</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- ===== Teacher home (classes) ===== -->
  <div id="classesPage" class="hidden">
    <div class="container">
      <div class="card soft">
        <div class="row" style="align-items:center">
          <div class="col">
            <div style="font-weight:1000;color:#0b2a66">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¹Ù„Ù…Ø©</div>
            <div class="small">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙØµÙˆÙ„ ÙˆØ§Ù„Ø·Ù„Ø§Ø¨ + Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø´Ø¹Ø§Ø± ÙˆØ§ØªØ³Ø§Ø¨ + ØªÙ‚Ø§Ø±ÙŠØ± PDF</div>
          </div>
          <div class="col" style="text-align:left">
            <button class="btn3" onclick="logout()">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
          </div>
        </div>
      </div>

      <div class="card soft">
        <h3 style="margin:0 0 8px 0;color:#0b2a66">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø³Ø±ÙŠØ¹ (WhatsApp)</h3>
        <div class="row">
          <label class="col small" style="display:flex;gap:8px;align-items:center">
            <input type="checkbox" id="autoWA" checked style="width:auto">
            ÙØªØ­ ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ù…Ø¨Ø§Ø´Ø±Ø©
          </label>
          <label class="col small" style="display:flex;gap:8px;align-items:center">
            <input type="checkbox" id="copyToTeacher" checked style="width:auto">
            Ø¥Ø±Ø³Ø§Ù„ Ù†Ø³Ø®Ø© Ù„Ù„Ù…Ø¹Ù„Ù…Ø©
          </label>
        </div>
        <div class="small" style="margin-top:6px">
          * ÙŠØªØ·Ù„Ø¨ ÙˆØ§ØªØ³Ø§Ø¨ Â«Ù†Ù‚Ø±Ø© Ø¥Ø±Ø³Ø§Ù„Â» Ø£Ø®ÙŠØ±Ø© âœ…
        </div>
      </div>

      <div class="card soft">
        <div class="row">
          <div class="col">
            <div class="small">Ø¥Ø¶Ø§ÙØ© ÙØµÙ„</div>
            <input id="newClassName" placeholder="Ù…Ø«Ø§Ù„: Ø®Ø§Ù…Ø³ Ø¨Ù†Ø§Øª">
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btn2" onclick="addClass()">Ø¥Ø¶Ø§ÙØ© ÙØµÙ„</button>
          </div>
        </div>
        <hr>
        <div class="row">
          <button class="btn2 col" onclick="renameClass()">ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„ÙØµÙ„</button>
          <button class="btnRed col" onclick="deleteClassMove()">Ø­Ø°Ù ÙØµÙ„ + Ù†Ù‚Ù„ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
          <button class="btn3 col" onclick="syncStudentsToClasses()">ØªØ«Ø¨ÙŠØª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨</button>
          <button class="btn3 col" onclick="toggleForgotPinForAll()">ØªØ¹Ø·ÙŠÙ„/ØªÙØ¹ÙŠÙ„ Ù†Ø³ÙŠØª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ</button>
        </div>
        <div class="small">Ø²Ø± "ØªØ«Ø¨ÙŠØª Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø·Ù„Ø§Ø¨" ÙŠØ±Ø¬Ø¹ ÙƒÙ„ Ø·Ø§Ù„Ø¨ Ù„ÙØµÙ„Ù‡ Ø§Ù„ØµØ­ÙŠØ­ + ÙŠØ¶ÙŠÙ Ø§Ù„Ù†Ø§Ù‚Øµ.</div>
      </div>

      <div class="tabs" id="classTabs"></div>

      <div class="card">
        <button class="btn" onclick="openClassPage()">Ø¯Ø®ÙˆÙ„ Ø§Ù„ÙØµÙ„</button>
      </div>
    </div>
  </div>

  <!-- ===== Class page ===== -->
  <div id="classPage" class="hidden">
    <div class="container">
      <div class="card soft">
        <div class="row" style="align-items:center">
          <div class="col">
            <div style="font-weight:1000;color:#0b2a66" id="classTitle">Ø§Ù„ÙØµÙ„</div>
            <div class="small">Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹/Ø§Ù„Ø³Ø­Ø¨/Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ù…Ø¹ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ Ø«Ø§Ø¨ØªØ©</div>
          </div>
          <div class="col" style="text-align:left">
            <button class="btn3" onclick="backToClasses()">Ø±Ø¬ÙˆØ¹ Ù„Ù„ÙØµÙˆÙ„</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <div class="small">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</div>
            <input id="newStudentName" placeholder="Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø§Ù„Ø·Ø§Ù„Ø¨Ø©">
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btn2" onclick="addStudent()">Ø¥Ø¶Ø§ÙØ© Ø·Ø§Ù„Ø¨</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <div class="small">Ù…Ø¨Ù„Øº Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„ÙƒÙ„</div>
            <input id="bulkAmount" type="number" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 10">
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btn" onclick="depositAll()">Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„ÙƒÙ„</button>
          </div>

          <div class="col">
            <div class="small">Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ÙƒÙ„</div>
            <input id="bulkWithdrawAmount" type="number" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 5">
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btnRed" onclick="withdrawAll()">Ø³Ø­Ø¨ Ù„Ù„ÙƒÙ„</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <div class="small">Ø·Ø§Ù„Ø¨ Ù…Ø­Ø¯Ø¯</div>
            <select id="pickStudent"></select>
          </div>
          <div class="col">
            <div class="small">Ø§Ù„Ù…Ø¨Ù„Øº</div>
            <input id="pickAmount" type="number" step="0.01" placeholder="Ù…Ø«Ø§Ù„: 5">
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btn2" onclick="depositToStudent()">Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ø·Ø§Ù„Ø¨</button>
          </div>
          <div class="col" style="align-self:flex-end">
            <button class="btnRed" onclick="withdrawFromStudent()">Ø³Ø­Ø¨ Ù…Ù† Ø·Ø§Ù„Ø¨</button>
          </div>
        </div>

        <hr>

        <div class="row">
          <div class="col">
            <div class="small">Ø³Ø¨Ø¨ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© (Ø«Ø§Ø¨Øª)</div>
            <select id="reasonTeacher"></select>
            <input id="reasonOtherTeacher" class="hidden" placeholder="Ø£Ø®Ø±Ù‰: Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ù‡Ù†Ø§..." style="margin-top:8px">
          </div>
        </div>

        <hr>

        <div class="row" style="align-items:center">
          <label class="small" style="display:flex;gap:8px;align-items:center">
            <input type="checkbox" id="selAll" onchange="toggleSelectAll()" style="width:auto"> ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙƒÙ„
          </label>
          <button class="btn2" onclick="depositSelected()">Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†</button>
          <button class="btnRed" onclick="withdrawSelected()">Ø³Ø­Ø¨ Ù„Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†</button>
          <div class="small" id="selCount">Ø§Ù„Ù…Ø­Ø¯Ø¯: 0</div>
        </div>
      </div>

      <div id="studentsGrid" class="grid2"></div>
    </div>
  </div>

  <!-- ===== Student account ===== -->
  <div id="studentAccountPage" class="hidden">
    <div class="container">
      <div class="card soft">
        <div class="row" style="align-items:center">
          <div class="col">
            <div style="font-weight:1000;color:#0b2a66" id="studentHeader">â€”</div>
            <div class="small" id="studentSub">Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨</div>
          </div>
          <div class="col" style="text-align:left">
            <button class="btn3" onclick="backAfterStudent()">Ø±Ø¬ÙˆØ¹</button>
          </div>
        </div>

        <div class="row" style="margin-top:10px;align-items:center">
          <div class="col"><div class="small">Ø§Ù„Ø­Ø§Ù„Ø©</div><div id="statusBadge" class="badge"></div></div>
          <div class="col"><div class="small">Ø§Ù„Ø±ØµÙŠØ¯</div><div style="font-size:26px;font-weight:1000;color:#0b2a66"><span id="studentBalance">0</span> Ø±.Ø³</div></div>
          <div class="col"><div class="small">Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨</div><div style="font-weight:1000;color:#0b2a66" id="tierLabel">â€”</div></div>
          <div class="col"><div class="small">ØªØ§Ø±ÙŠØ® ÙØªØ­ Ø§Ù„Ø­Ø³Ø§Ø¨</div><div id="openedAt" class="small">â€”</div></div>
        </div>

        <!-- Card -->
        <div class="bankCard" style="margin-top:12px">
          <div class="geo"></div>
          <div class="inner">
            <div class="bankBrand">
              <div>
                <div class="b1">Math Bank Card</div>
                <div class="b2">Ø¨Ø·Ø§Ù‚Ø© Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€“ Ø¥ØµØ¯Ø§Ø± Ù…Ø¯Ø±Ø³ÙŠ</div>
              </div>
              <div class="chip" aria-hidden="true"></div>
            </div>

            <div class="cardNum" id="cardNumber">0000 0000 0000 0000</div>

            <div class="cardMeta">
              <div class="metaItem"><span>EXP</span><div id="cardExp">12/29</div></div>
              <div class="metaItem"><span>PIN</span><div id="cardPin">â€¢â€¢â€¢â€¢</div></div>
              <div class="metaItem"><span>Account</span><div id="cardAcc">MB-0000000000</div></div>
            </div>

            <div class="holder" id="cardHolder">â€”</div>
            <div class="cardHint">Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚ØªÙƒ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆÙ„Ø§ ØªØ´Ø§Ø±Ùƒ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù…Ø¹ Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†.</div>
          </div>
        </div>

        <!-- Mini Tabs -->
        <div class="miniTabs" style="margin-top:12px">
          <div class="miniTab active" onclick="setMiniTab('paneStmt',this)">ğŸ“„ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="miniTab" onclick="setMiniTab('paneUpgrade',this)">â¬†ï¸ ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨</div>
          <div class="miniTab" onclick="setMiniTab('paneRewards',this)">ğŸ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² ÙˆØ§Ù„Ø­ÙˆØ§ÙØ²</div>
          <div class="miniTab" onclick="setMiniTab('paneCard',this)">ğŸ’³ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
        </div>

        <!-- Pane: Statement -->
        <div id="paneStmt" class="miniPane active">
          <div class="kpis">
            <div class="kpi"><div class="k">Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div><div class="v" id="kpiWeekCount">0</div></div>
            <div class="kpi"><div class="k">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</div><div class="v" id="kpiWeekDep">0</div></div>
            <div class="kpi"><div class="k">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­Ø¨</div><div class="v" id="kpiWeekWith">0</div></div>
            <div class="kpi"><div class="k">Ø§Ù„ØµØ§ÙÙŠ</div><div class="v" id="kpiWeekNet">0</div></div>
          </div>

          <div class="card" style="margin:12px 0 0 0">
            <h3 style="margin:0 0 10px 0;color:#0b2a66;font-size:15px">ØªÙ†ÙÙŠØ° Ø¹Ù…Ù„ÙŠØ©</h3>

            <!-- âœ… Ù†ÙØ³ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© + Ù„Ø§ Ù†ØºÙŠØ± Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ -->
            <div class="row">
              <div class="col">
                <div class="small">Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</div>
                <select id="op">
                  <option value="deposit">Ø¥ÙŠØ¯Ø§Ø¹</option>
                  <option value="withdraw">Ø³Ø­Ø¨</option>
                  <option value="transfer">ØªØ­ÙˆÙŠÙ„</option>
                </select>
              </div>

              <div class="col">
                <div class="small">Ø§Ù„Ø³Ø¨Ø¨</div>
                <select id="reasonStudent"></select>
                <input id="reasonOtherStudent" class="hidden" placeholder="Ø£Ø®Ø±Ù‰: Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ù‡Ù†Ø§..." style="margin-top:8px">
              </div>

              <div class="col"><div class="small">Ø§Ù„Ù…Ø¨Ù„Øº</div><input id="amt" type="number" step="0.01"></div>
              <div class="col"><div class="small">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰</div><select id="transferTo"></select></div>
            </div>

            <div class="row">
              <button class="btn col" onclick="executeOp()">ØªÙ†ÙÙŠØ°</button>
              <button class="btn2 col" onclick="downloadStudentStatementPDF()">PDF Ø±Ø³Ù…ÙŠ</button>
            </div>
          </div>

          <div class="row" style="margin-top:12px">
            <div class="col"><div class="small">Ù…Ù† ØªØ§Ø±ÙŠØ®</div><input id="fromDate" type="date"></div>
            <div class="col"><div class="small">Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</div><input id="toDate" type="date"></div>
            <div class="col" style="align-self:flex-end"><button class="btn3" onclick="showStatement()">Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨</button></div>
          </div>

          <div class="tableWrap" style="margin-top:10px">
            <table>
              <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th></tr></thead>
              <tbody id="stmtRows"></tbody>
            </table>
          </div>
        </div>

        <!-- Pane: Upgrade -->
        <div id="paneUpgrade" class="miniPane">
          <div class="card" style="margin-top:12px">
            <h3 style="margin:0;color:#0b2a66">Ù†Ø¸Ø§Ù… ØªØ±Ù‚ÙŠØ© Ø§Ù„Ø­Ø³Ø§Ø¨</h3>
            <div class="small" style="margin-top:6px">Ø§Ù„ØªØ±Ù‚ÙŠØ© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø±ØµÙŠØ¯ (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§):</div>
            <div class="row" style="margin-top:10px">
              <div class="col">
                <div class="card soft">
                  <div style="font-weight:1000;color:#0b2a66">ğŸ¥‰ Ø¨Ø±ÙˆÙ†Ø²ÙŠ</div>
                  <div class="small">Ù…Ù† 0 Ø¥Ù„Ù‰ Ø£Ù‚Ù„ Ù…Ù† 70</div>
                </div>
              </div>
              <div class="col">
                <div class="card soft">
                  <div style="font-weight:1000;color:#0b2a66">ğŸ¥ˆ ÙØ¶ÙŠ</div>
                  <div class="small">Ù…Ù† 70 Ø¥Ù„Ù‰ Ø£Ù‚Ù„ Ù…Ù† 150</div>
                </div>
              </div>
              <div class="col">
                <div class="card soft">
                  <div style="font-weight:1000;color:#0b2a66">ğŸ¥‡ Ø°Ù‡Ø¨ÙŠ</div>
                  <div class="small">Ù…Ù† 150 Ø¥Ù„Ù‰ Ø£Ù‚Ù„ Ù…Ù† 300</div>
                </div>
              </div>
              <div class="col">
                <div class="card soft">
                  <div style="font-weight:1000;color:#0b2a66">ğŸ”· Ù…Ø§Ø³ÙŠ</div>
                  <div class="small">Ù…Ù† 300 Ø¥Ù„Ù‰ Ø£Ù‚Ù„ Ù…Ù† 500</div>
                </div>
              </div>
              <div class="col">
                <div class="card soft">
                  <div style="font-weight:1000;color:#0b2a66">ğŸ’ Ø£Ù„Ù…Ø§Ø³ÙŠ</div>
                  <div class="small">500 ÙØ£ÙƒØ«Ø±</div>
                </div>
              </div>
            </div>
            <div class="small" style="margin-top:8px">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¥Ø°Ø§ ØªØ¨ÙŠÙ† (10,000 Ø«Ù… +3,000 Ù„ÙƒÙ„ Ù…Ø³Ù…Ù‰) Ù‚ÙˆÙ„ÙŠ ÙˆØ£Ø¹Ø¯Ù‘Ù„Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©.</div>
          </div>
        </div>

        <!-- Pane: Rewards -->
        <div id="paneRewards" class="miniPane">
          <div class="card" style="margin-top:12px">
            <h3 style="margin:0;color:#0b2a66">ğŸ Ø§Ù„Ø¬ÙˆØ§Ø¦Ø² ÙˆØ§Ù„Ø­ÙˆØ§ÙØ²</h3>
            <div class="small" style="margin-top:6px">Ø§Ù‚ØªØ±Ø§Ø­ Ù†Ø¸Ø§Ù… Ø¬ÙˆØ§Ø¦Ø² Ø¬Ø§Ù‡Ø² (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ®ØµÙŠØµ):</div>
            <div class="row" style="margin-top:10px">
              <div class="col"><div class="card soft"><div style="font-weight:1000;color:#0b2a66">ğŸ† Ø¨Ø·Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div><div class="small">Ø£Ø¹Ù„Ù‰ ØµØ§ÙÙŠ Ù†Ù‚Ø§Ø· Ø®Ù„Ø§Ù„ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</div></div></div>
              <div class="col"><div class="card soft"><div style="font-weight:1000;color:#0b2a66">ğŸ–ï¸ Ù†Ø¬Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù…</div><div class="small">0 Ù…Ø®Ø§Ù„ÙØ§Øª Ø®Ù„Ø§Ù„ 5 Ø£ÙŠØ§Ù…</div></div></div>
              <div class="col"><div class="card soft"><div style="font-weight:1000;color:#0b2a66">ğŸ¯ Ù†Ø¬Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©</div><div class="small">ØªÙØ§Ø¹Ù„ Ù…Ø³ØªÙ…Ø± ÙÙŠ Ø§Ù„Ø­ØµØµ</div></div></div>
            </div>
            <div class="small">Ø³ÙŠØªÙ… Ù„Ø§Ø­Ù‚Ù‹Ø§ Ø±Ø¨Ø·Ù‡Ø§ Ø¢Ù„ÙŠÙ‹Ø§ Ù…Ù† Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª.</div>
          </div>
        </div>

        <!-- Pane: Card details -->
        <div id="paneCard" class="miniPane">
          <div class="card" style="margin-top:12px">
            <h3 style="margin:0;color:#0b2a66">ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h3>
            <div class="row" style="margin-top:10px">
              <div class="col">
                <div class="small">Ø§Ø³Ù… ØµØ§Ø­Ø¨ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</div>
                <div style="font-weight:1000;color:#0b2a66" id="detailName">â€”</div>
              </div>
              <div class="col">
                <div class="small">Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨</div>
                <div style="font-weight:1000;color:#0b2a66;direction:ltr;text-align:left" id="detailAcc">â€”</div>
              </div>
              <div class="col">
                <div class="small">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡</div>
                <div style="font-weight:1000;color:#0b2a66" id="detailExp">â€”</div>
              </div>
              <div class="col">
                <div class="small">Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (PIN)</div>
                <div style="font-weight:1000;color:#0b2a66" id="detailPin">â€”</div>
              </div>
            </div>
            <div class="cardHint" style="margin-top:12px">âš ï¸ Ø­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø¨Ø·Ø§Ù‚ØªÙƒ ÙˆØ¨ÙŠØ§Ù†Ø§ØªÙƒ ÙˆÙ„Ø§ ØªÙØ¸Ù‡Ø± Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù„Ù„Ø¢Ø®Ø±ÙŠÙ†.</div>
          </div>

          <div class="card">
            <h3 style="margin:0;color:#0b2a66">Ø§Ù„Ø­ÙˆØ§Ù„Ø§Øª</h3>
            <div class="small" style="margin-top:6px">Ø³ÙŠØ¸Ù‡Ø± Ø¯Ø§Ø®Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„:</div>
            <ul class="small" style="line-height:1.9;margin:10px 0 0 0">
              <li>Ø¨ÙŠÙ† Ø­Ø³Ø§Ø¨Ø§ØªÙŠ (Ù„Ù†ÙØ³ Ø§Ù„Ø·Ø§Ù„Ø¨) â€” Ù‚Ø§Ø¯Ù…Ù‹Ø§</li>
              <li>Ø¯Ø§Ø®Ù„ Ø§Ù„ÙØµÙ„ (ÙŠØ¸Ù‡Ø± Ø£Ø³Ù…Ø§Ø¡ Ø²Ù…Ù„Ø§Ø¡ Ù†ÙØ³ Ø§Ù„ÙØµÙ„)</li>
              <li>Ø­ÙˆØ§Ù„Ø© Ù…Ø­Ù„ÙŠØ© Ù„ÙØµÙ„ Ø¢Ø®Ø± (ÙƒÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨)</li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ===== Footer links (public) ===== -->
  <div class="footerBar" id="publicFooter">
    <div class="footerLinks">
      <a href="javascript:void(0)" onclick="openContact()">Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
      <a href="javascript:void(0)" onclick="openAbout()">ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ø¨Ù†Ùƒ</a>
      <a href="javascript:void(0)" onclick="openHelp()">Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø©</a>
    </div>
    <div class="footerNote">Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ù„ØºØ© Ø§Ù„Ø£Ø°ÙƒÙŠØ§Ø¡ âœ¨</div>
  </div>

  <audio id="welcomeMp3" preload="auto" src="welcome.mp3"></audio>
  <audio id="welcomeM4a" preload="auto" src="welcome.m4a"></audio>

  <!-- libs -->
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore-compat.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <div id="pdfTemp"></div>

  <script>
    // ================== Mode ==================
    const urlParams = new URLSearchParams(window.location.search);
    const APP_MODE = (urlParams.get("mode") || "teacher").toLowerCase(); // teacher|student
    const IS_STUDENT_ENTRY = (APP_MODE === "student");

    // ================== WhatsApp / Contacts ==================
    const SIGNATURE = "Ø§Ù„Ù…Ø¹Ù„Ù…Ø©: Ø³Ø§Ø±Ø© Ø­Ù‚ÙˆÙŠ";
    const TEACHER_BANK_TITLE = "Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª â€“ Ø§Ù„Ù…ØµØ±ÙÙŠ";
    const CONTACT_PRIMARY = "0502234335"; // Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨
    const WHATSAPP_BUSINESS = "0556891201"; // Ø´ÙƒØ§ÙˆÙ‰ / Ø¨Ø²Ù†Ø³
    const ADMIN_EMAIL = "saramathss@hotmail.com";
    const TEACHER_EMAIL = "as-soso-as2011@hotmail.com";

    // ================== Firebase ==================
    const firebaseConfig = {
      apiKey: "AIzaSyDP-pi0tbFQ9bNRihrLz_kUs-JBoa9Cw4Y",
      authDomain: "sara-haywire.firebaseapp.com",
      projectId: "sara-haywire",
      storageBucket: "sara-haywire.firebasestorage.app",
      messagingSenderId: "333467940977",
      appId: "1:333467940977:web:97d056d5dbff2debbf43d0",
      measurementId: "G-7RPQX9ER93"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // ================== Helpers ==================
    function $(id){return document.getElementById(id);}
    function fmt(x){ return (Math.round((Number(x||0)+Number.EPSILON)*100)/100).toFixed(2); }

    function openModal(title, bodyHtml, actionsHtml){
      $("mTitle").textContent = title;
      $("mBody").innerHTML = bodyHtml;
      $("mActions").innerHTML = actionsHtml || '<button class="btn" onclick="closeModal()">Ù…ÙˆØ§ÙÙ‚</button>';
      $("modal").style.display="flex";
      $("modal").setAttribute("aria-hidden","false");
    }
    function closeModal(){
      $("modal").style.display="none";
      $("modal").setAttribute("aria-hidden","true");
    }
    function warn(msg){ openModal("ØªÙ†Ø¨ÙŠÙ‡", msg); }

    function togglePass(id, btn){
      const el = $(id);
      if(!el) return;
      el.type = (el.type === "password") ? "text" : "password";
      btn.textContent = (el.type === "password") ? "ğŸ‘ï¸" : "ğŸ™ˆ";
    }

    function normalizePhoneToWA(phone){
      let p = String(phone||"").replace(/[^0-9]/g,"");
      if(!p) return "";
      if(p.startsWith("00")) p = p.slice(2);
      if(p.startsWith("0")) p = "966" + p.slice(1);
      return p;
    }
    function contactLink(){ return "https://wa.me/" + normalizePhoneToWA(CONTACT_PRIMARY); }

    function openWA(toPhone, messageText){
      const phone = normalizePhoneToWA(toPhone);
      if(!phone) return;

      const enc = encodeURIComponent(messageText || "");
      // iOS: whatsapp-business:// often fails; use whatsapp:// then https fallback
      const scheme1 = "whatsapp://send?phone=" + phone + "&text=" + enc;
      const web1 = "https://wa.me/" + phone + "?text=" + enc;

      // try scheme
      window.location.href = scheme1;

      // fallback
      setTimeout(()=>{
        // if still here, open web
        window.location.href = web1;
      }, 900);
    }

    function buildOfficialMessage(type, student, amount, reason){
      const warnLine = "âš ï¸ Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©";
      return (
`${warnLine}
${TEACHER_BANK_TITLE}

ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø¹Ù…Ù„ÙŠØ© Ø¹Ù„Ù‰ Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø©:
${student}

Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©: ${type}
Ø§Ù„Ù…Ø¨Ù„Øº: ${String(amount ?? "")} Ø±ÙŠØ§Ù„
Ø§Ù„Ø³Ø¨Ø¨: ${reason || "â€”"}

* Ù‡Ù†Ø§ Ù„Ø§ Ù†Ø³ØªØ·ÙŠØ¹ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ø¦Ù„.
Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© Ø§Ø¶ØºØ· Ø§Ù„Ø±Ø§Ø¨Ø·:
${contactLink()}

${SIGNATURE}`
      );
    }

    function isAutoWAEnabled(){ return !!$("autoWA")?.checked; }
    function isCopyEnabled(){ return !!$("copyToTeacher")?.checked; }

    async function beep(){
      try{
        const ctx=new (window.AudioContext||window.webkitAudioContext)();
        const o=ctx.createOscillator(), g=ctx.createGain();
        o.type="triangle"; o.frequency.value=740; g.gain.value=0.12;
        o.connect(g); g.connect(ctx.destination); o.start();
        setTimeout(()=>{o.stop(); ctx.close();}, 220);
      }catch(e){}
    }
    async function playWelcome(){
      const m4a = $("welcomeM4a");
      const mp3 = $("welcomeMp3");
      await beep();
      try{ if(m4a){ m4a.currentTime=0; await m4a.play(); return; } }catch(e){}
      try{ if(mp3){ mp3.currentTime=0; await mp3.play(); return; } }catch(e){}
    }

    // ================== Public footer sections ==================
    function openContact(){
      const body = `
        <div style="display:flex;justify-content:space-between;gap:10px;align-items:center;flex-wrap:wrap">
          <div>
            <div style="font-weight:1000;color:#0b2a66;font-size:16px">Ø§ØªØµÙ„ Ø¨Ù†Ø§</div>
            <div class="small">Ù†Ø­Ù† Ù‡Ù†Ø§ Ù„Ø®Ø¯Ù…ØªÙƒ</div>
          </div>
        </div>
        <hr>
        <div class="card soft" style="margin:0">
          <div style="font-weight:1000;color:#0b2a66">ğŸ“ Ø®Ø¯Ù…Ø© Ø§Ù„Ø·Ù„Ø§Ø¨</div>
          <div class="small" style="direction:ltr;text-align:left">${CONTACT_PRIMARY}</div>
          <div style="margin-top:10px;font-weight:1000;color:#0b2a66">ğŸ’¬ Ù„Ù„Ø´ÙƒØ§ÙˆÙ‰ (ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø²Ù†Ø³)</div>
          <div class="small" style="direction:ltr;text-align:left">${WHATSAPP_BUSINESS}</div>
          <div style="margin-top:10px;font-weight:1000;color:#0b2a66">ğŸ›ï¸ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ø§Ù…Ø©</div>
          <div class="small" style="direction:ltr;text-align:left">${CONTACT_PRIMARY}</div>
          <div class="small" style="direction:ltr;text-align:left">${ADMIN_EMAIL}</div>
        </div>
        <hr>
        <div class="row">
          <button class="btn2 col" onclick="openPolicy('privacy')">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ© âœ</button>
          <button class="btn2 col" onclick="openPolicy('disclaimer')">Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ© âœ</button>
          <button class="btn2 col" onclick="openPolicy('terms')">Ø§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ§Ù„Ø´Ø±ÙˆØ· âœ</button>
        </div>
      `;
      openModal("Ø§ØªØµÙ„ Ø¨Ù†Ø§", body, '<button class="btn" onclick="closeModal()">Ø±Ø¬ÙˆØ¹</button>');
    }

    function openAbout(){
      const body = `
        <div style="font-weight:1000;color:#0b2a66;font-size:16px">ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ø¨Ù†Ùƒ</div>
        <div class="small" style="margin-top:4px">Ù†Ø¸Ø§Ù… Ù…Ø¯Ø±Ø³ÙŠ Ø±Ø³Ù…ÙŠ â€“ Ù…ØªØ§Ø¨Ø¹Ø©ØŒ ØªØ­ÙÙŠØ²ØŒ ÙˆØ´ÙØ§ÙÙŠØ©</div>
        <hr>
        <div class="card soft" style="margin:0">
          <div style="font-weight:1000;color:#0b2a66">Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„Ø©</div>
          <div class="small">${SIGNATURE}</div>
          <div style="margin-top:10px;font-weight:1000;color:#0b2a66">ØªØ§Ø±ÙŠØ® Ø§ÙØªØªØ§Ø­ Ø§Ù„Ø¨Ù†Ùƒ</div>
          <div class="small">ÙŠÙØ­Ø¯Ù‘Ø« Ø­Ø³Ø¨ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</div>
          <div style="margin-top:10px;font-weight:1000;color:#0b2a66">Ø§Ù„Ø£Ù‡Ø¯Ø§Ù</div>
          <ul class="small" style="line-height:1.9;margin:8px 0 0 0">
            <li>Ø±ÙØ¹ Ø§Ù„Ø§Ù†Ø¶Ø¨Ø§Ø· ÙˆØ§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ØµØ©.</li>
            <li>ØªØ¹Ø²ÙŠØ² Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©.</li>
            <li>ØªÙˆÙÙŠØ± ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ø¶Ø­Ø© Ù„Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±.</li>
            <li>Ø¯Ø¹Ù… Ø¬ÙˆØ¯Ø© Ø§Ù„Ù…Ù…Ø§Ø±Ø³Ø§Øª Ø§Ù„ØªØ¹Ù„ÙŠÙ…ÙŠØ© Ø§Ù„Ù…ØªÙ…Ø§Ø´ÙŠØ© Ù…Ø¹ Ø±Ø¤ÙŠØ© 2030.</li>
            <li>ÙŠØ³Ù‡Ù… ÙÙŠ ØªÙˆØ«ÙŠÙ‚ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ù…Ù‡Ù†ÙŠ Ù„Ù„Ù…Ø¹Ù„Ù…Ø§Øª.</li>
          </ul>
        </div>
      `;
      openModal("ØªØ¹Ø±ÙŠÙ Ø¨Ø§Ù„Ø¨Ù†Ùƒ", body, '<button class="btn" onclick="closeModal()">Ø±Ø¬ÙˆØ¹</button>');
    }

    function openHelp(){
      const body = `
        <div style="font-weight:1000;color:#0b2a66;font-size:16px">Ù‡Ù„ ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ Ù…Ø³Ø§Ø¹Ø¯Ø©ØŸ</div>
        <hr>
        <div class="small" style="line-height:1.9">
          â€¢ Ù„Ù„Ø·Ù„Ø§Ø¨: Ø§Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… + PIN Ø«Ù… Ù†ÙØ° Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø£Ùˆ Ø§Ø¹Ø±Ø¶ ÙƒØ´Ù Ø§Ù„Ø­Ø³Ø§Ø¨.\\n
          â€¢ Ù„Ù„Ù…Ø¹Ù„Ù…Ø©: teacher / 12345 (ØªØ¬Ø±ÙŠØ¨ÙŠ) Ø«Ù… Ø§Ø®ØªØ§Ø±ÙŠ Ø§Ù„ÙØµÙ„.\\n
          â€¢ Ù…Ø´ÙƒÙ„Ø© Ø§Ù„ØµÙˆØª: Ù„Ø§Ø²Ù… ÙŠØªÙ… Ø§Ù„ØªØ´ØºÙŠÙ„ Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ (Ù…Ø«Ù„ Ø²Ø± Ø¯Ø®ÙˆÙ„).\\n
          â€¢ Ù…Ø´ÙƒÙ„Ø© ÙˆØ§ØªØ³Ø§Ø¨: Ø¥Ø°Ø§ Ù…Ø§ ÙØªØ­ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙŠØªØ­ÙˆÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ Ù„ØµÙØ­Ø© wa.me.
        </div>
      `;
      openModal("Ù…Ø³Ø§Ø¹Ø¯Ø©", body, '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
    }

    function openPolicy(which){
      let title=""; let body="";
      if(which==="privacy"){
        title="Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø®ØµÙˆØµÙŠØ©";
        body = `<div class="small" style="line-height:1.9">
          ÙŠÙ„ØªØ²Ù… Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø¨Ø­Ù…Ø§ÙŠØ© Ø®ØµÙˆØµÙŠØ© Ø§Ù„Ø·Ø§Ù„Ø¨/Ù€Ø©. ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø£ØºØ±Ø§Ø¶ Ù…Ø¯Ø±Ø³ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ÙÙ‚Ø·ØŒ ÙˆØªØ´Ù…Ù„: Ø§Ù„Ø§Ø³Ù…ØŒ Ø§Ù„Ø±ØµÙŠØ¯ØŒ ÙˆØ³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª.
          Ù„Ø§ ÙŠØªÙ… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø±Ø¬ Ù†Ø·Ø§Ù‚ Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø¥Ù„Ø§ Ø¨Ø¥Ø´Ø¹Ø§Ø± ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ø¹Ù†Ø¯ ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.
        </div>`;
      }else if(which==="disclaimer"){
        title="Ø¥Ø®Ù„Ø§Ø¡ Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©";
        body = `<div class="small" style="line-height:1.9">
          Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ø£Ø¯Ø§Ø© Ù…Ø¯Ø±Ø³ÙŠØ© ØªØ­ÙÙŠØ²ÙŠØ©ØŒ ÙˆÙ„Ø§ ÙŠÙ…Ø«Ù„ Ù†Ø¸Ø§Ù…Ù‹Ø§ Ù…ØµØ±ÙÙŠÙ‹Ø§ Ø­Ù‚ÙŠÙ‚ÙŠÙ‹Ø§ Ø£Ùˆ Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ù…Ø§Ù„ÙŠØ© Ø­Ù‚ÙŠÙ‚ÙŠØ©. Ø§Ù„Ø±ØµÙŠØ¯ Ø±Ù…Ø²ÙŠ Ù„Ù„ØªØ¹Ø²ÙŠØ² ÙˆØ§Ù„ØªØ­ÙÙŠØ².
        </div>`;
      }else{
        title="Ø§Ù„Ø£Ø­ÙƒØ§Ù… ÙˆØ§Ù„Ø´Ø±ÙˆØ·";
        body = `<div class="small" style="line-height:1.9">
          Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… ÙØ£Ù†Øª ØªÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰: Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø¶ÙˆØ§Ø¨Ø· Ø§Ù„Ù…Ø¯Ø±Ø³Ø©ØŒ Ø¹Ø¯Ù… Ø¥Ø³Ø§Ø¡Ø© Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…ØŒ ÙˆØ¹Ø¯Ù… Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ.
          Ù„Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø­Ù‚ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¹Ù†Ø¯ Ù…Ø®Ø§Ù„ÙØ© Ø§Ù„Ø³ÙŠØ§Ø³Ø§Øª.
        </div>`;
      }
      openModal(title, body, '<button class="btn" onclick="closeModal()">Ø±Ø¬ÙˆØ¹</button>');
    }

    // ================== Navigation ==================
    function hideAllPages(){
      ["startOverlay","onboardOverlay","teacherLoginPage","studentLoginPage","classesPage","classPage","studentAccountPage"].forEach(id=>{
        const el=$(id); if(el) el.classList.add("hidden");
      });
    }
    function show(id){
      const el=$(id); if(el) el.classList.remove("hidden");
    }
    function goPublic(){
      hideAllPages();
      show("startOverlay");
    }
    function logout(){ location.reload(); }

    // ================== Reasons (unchanged) ==================
    const REASONS = {
      deposit: [
        "Ø§Ù„ØªÙØ§Ø¹Ù„ ÙˆØ§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ©",
        "Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„ØµÙÙŠØ©",
        "Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ù…ØªØ·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø§Ø¯Ø© ÙˆØ§Ù„Ø­ØµØ©",
        "ØªÙ…ÙŠØ² ÙÙŠ Ø§Ù„Ø£Ø¯Ø§Ø¡ ÙˆØ§Ù„Ø³Ù„ÙˆÙƒ",
        "ØªØ­Ø³Ù† Ù…Ù„Ø­ÙˆØ¸ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ Ø£Ùˆ Ø§Ù„Ø³Ù„ÙˆÙƒ",
        "Ø£Ø®Ø±Ù‰"
      ],
      withdraw: [
        "Ø¹Ø¯Ù… Ø­Ù„ Ø§Ù„ÙˆØ§Ø¬Ø¨ Ø§Ù„Ø¯Ø±Ø§Ø³ÙŠ",
        "ÙƒØ«Ø±Ø© Ø§Ù„ÙƒÙ„Ø§Ù… ÙˆØ§Ù„Ø­Ø±ÙƒØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø­ØµØ©",
        "Ø§Ù„Ù†ÙˆÙ… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ØµØ©",
        "Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù„Ø§Ø¦Ù‚ Ù…Ø¹ Ø§Ù„Ø²Ù…Ù„Ø§Ø¡",
        "Ø¹Ø¯Ù… Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„Ù„Ø§Ø¦Ù‚ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©",
        "Ø§Ù„ØªØ£Ø®Ø± Ø¹Ù† Ø­ØµØ© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª Ø¯ÙˆÙ† Ø¹Ø°Ø±",
        "Ù†Ø³ÙŠØ§Ù† ÙƒØªØ§Ø¨ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
        "Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ø¯ÙØªØ±",
        "Ù†Ø³ÙŠØ§Ù† Ø§Ù„Ù…Ø°ÙƒØ±Ø©",
        "Ø¹Ø¯Ù… Ø¥Ø­Ø¶Ø§Ø± Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª",
        "Ø£Ø®Ø±Ù‰"
      ],
      transfer: [
        "ØªØ³Ø¯ÙŠØ¯/Ø¥Ø±Ø¬Ø§Ø¹ Ø±ØµÙŠØ¯",
        "Ù…Ø³Ø§Ø¹Ø¯Ø© Ø²Ù…ÙŠÙ„/Ù€Ø©",
        "Ø£Ø®Ø±Ù‰"
      ]
    };

    function fillReasonSelect(selectEl, items){
      if(!selectEl) return;
      selectEl.innerHTML = "";
      items.forEach(r=>{
        const o = document.createElement("option");
        o.value = r; o.textContent = r;
        selectEl.appendChild(o);
      });
    }

    let currentAccess = "teacher"; // teacher|student
    function setupReasonUI(mode, selectId, otherId){
      const sel = $(selectId);
      const other = $(otherId);
      if(!sel || !other) return;

      if(mode === "transfer" && currentAccess === "student"){
        sel.classList.add("hidden");
        sel.innerHTML = "";
        other.classList.remove("hidden");
        other.placeholder = "Ø³Ø¨Ø¨ Ø§Ù„ØªØ­ÙˆÙŠÙ„ (Ø§ÙƒØªØ¨ Ø³Ø¨Ø¨ Ø§Ù„ØªÙ†ÙÙŠØ° Ù‡Ù†Ø§...)";
        return;
      }

      sel.classList.remove("hidden");
      fillReasonSelect(sel, REASONS[mode] || ["Ø£Ø®Ø±Ù‰"]);

      const toggleOther = ()=>{
        if(sel.value === "Ø£Ø®Ø±Ù‰"){
          other.classList.remove("hidden");
          other.placeholder = "Ø£Ø®Ø±Ù‰: Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¨Ø¨ Ù‡Ù†Ø§...";
        }else{
          other.classList.add("hidden");
          other.value = "";
        }
      };
      sel.onchange = toggleOther;
      toggleOther();
    }

    function getReason(selectId, otherId){
      const sel = $(selectId);
      const other = $(otherId);
      if(sel && sel.classList.contains("hidden")){
        const t=(other?.value||"").trim();
        return t || "ØªØ­ÙˆÙŠÙ„";
      }
      if(!sel) return "";
      if(sel.value === "Ø£Ø®Ø±Ù‰"){
        const t=(other?.value||"").trim();
        return t || "Ø£Ø®Ø±Ù‰";
      }
      return sel.value || "";
    }

    function initTeacherReasonAlways(){
      const sel = $("reasonTeacher");
      if(!sel) return;
      const union = Array.from(new Set([ ...REASONS.deposit, ...REASONS.withdraw, ...REASONS.transfer ]));
      fillReasonSelect(sel, union);
      const other = $("reasonOtherTeacher");
      const toggleOther = ()=>{
        if(sel.value === "Ø£Ø®Ø±Ù‰"){ other.classList.remove("hidden"); }
        else { other.classList.add("hidden"); other.value=""; }
      };
      sel.onchange = toggleOther;
      toggleOther();
    }

    // ================== Onboarding (fixed swipe: no dragging text) ==================
    let onbIndex = 0;
    let onbAfterDone = null;
    let onbSwipeBound = false;

    function showOnboarding(afterDone){
      onbAfterDone = (typeof afterDone === "function") ? afterDone : null;
      onbIndex = 0;
      updateOnbUI();

      const ov = $("onboardOverlay");
      ov.classList.remove("hidden");
      ov.style.display = "flex";
      ov.setAttribute("aria-hidden","false");
      enableOnbSwipe();
    }
    function finishOnboarding(){
      const ov = $("onboardOverlay");
      ov.style.display="none";
      ov.setAttribute("aria-hidden","true");
      ov.classList.add("hidden");
      const cb = onbAfterDone;
      onbAfterDone = null;
      if(typeof cb === "function") cb();
    }
    function updateOnbUI(){
      const track = $("onbTrack");
      const dotsWrap = $("onbDots");
      if(track) track.style.transform = `translateX(-${onbIndex * 100}%)`;
      if(dotsWrap){
        const dots = dotsWrap.querySelectorAll(".onbDot");
        dots.forEach((d,i)=> d.classList.toggle("active", i===onbIndex));
      }
    }
    function onbNext(){ if(onbIndex >= 2) return finishOnboarding(); onbIndex++; updateOnbUI(); }
    function onbPrev(){ if(onbIndex <= 0) return; onbIndex--; updateOnbUI(); }

    function enableOnbSwipe(){
      if(onbSwipeBound) return;
      const vp = $("onbViewport");
      if(!vp) return;
      onbSwipeBound = true;

      let startX = 0, dx = 0, dragging=false;

      const onDown = (x)=>{ dragging=true; startX=x; dx=0; };
      const onMove = (x)=>{ if(!dragging) return; dx = x-startX; };
      const onUp = ()=>{
        if(!dragging) return;
        dragging=false;
        // no dragging transform => prevents "text moves with swipe"
        if(Math.abs(dx) > 45){
          if(dx > 0) onbPrev(); else onbNext();
        }
        dx=0;
      };

      vp.addEventListener("pointerdown",(e)=>{ vp.setPointerCapture?.(e.pointerId); onDown(e.clientX); });
      vp.addEventListener("pointermove",(e)=> onMove(e.clientX));
      vp.addEventListener("pointerup",()=> onUp());
      vp.addEventListener("pointercancel",()=> onUp());

      vp.addEventListener("touchstart",(e)=>{ if(e.touches?.[0]) onDown(e.touches[0].clientX); },{passive:true});
      vp.addEventListener("touchmove",(e)=>{ if(e.touches?.[0]) onMove(e.touches[0].clientX); },{passive:true});
      vp.addEventListener("touchend",()=> onUp());
    }

    // ================== Seed data (same as before) ==================
    const DEFAULT_STUDENTS = {
      "Ø³Ø§Ø¯Ø³ Ø¨Ù†ÙŠÙ†": ["Ø·Ù„Ø§Ù„ Ø§Ù„Ø±Ø­ÙŠÙ„ÙŠ","Ø¹Ù„ÙŠ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ","Ø¹Ù…Ø± ØµÙˆØ§Ù","Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠ","Ø³Ø§Ù„Ù… Ø¢Ù„ Ù…Ø®Ù„Øµ","Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø¬Ù†Ø§Ø¹ÙŠ","ÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ","Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆÙ‡Ø±","Ø±Ø§ÙƒØ§Ù† Ù…Ø¨Ø§Ø±ÙƒÙŠ","ÙÙŠØµÙ„ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ","Ø±ÙŠØ§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ","Ù…Ø­Ù…Ø¯ Ø£Ø¨Ùˆ ØµØ§Ù„Ø­","Ù†Ø§ÙŠÙ Ø§Ù„Ø¹ØµÙŠÙ…ÙŠ"],
      "Ø³Ø§Ø¯Ø³ Ø¨Ù†Ø§Øª": ["Ø±Ù‡Ù Ø§Ù„Ø«Ø¨ÙŠØªÙŠ","Ø¬Ø§Ø¯Ù„ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ","Ø¯Ø§Ù†Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ","ØªØ§Ù„ÙŠÙ† Ù…ØªÙˆÙ„ÙŠ","Ø¯ÙŠÙ…Ø§ Ø§Ù„Ø­Ù…Ø§Ø¯ÙŠ","Ø±Ù‡Ù Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ","ÙƒØ§Ø¯ÙŠ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ","Ø±ÙˆØ¯ÙŠÙ†Ø§ ØºØ±ÙŠØ¨","Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© Ø¢Ù„ Ù…Ø®Ù„Øµ","Ø±ÙŠÙ… Ø¢Ù„ Ù…Ø´Ø±Ù"],
      "Ø£ÙˆÙ„ Ù…ØªÙˆØ³Ø·": ["Ø§ÙŠÙ…Ø§Ù† Ø¨Ø§ØºØ±ÙŠØ¨","Ø¯ÙŠÙ…Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ","Ù†Ø¬Ù„Ø§ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ","Ø¯ÙŠÙ… Ø§Ù„ØºØ§Ù…Ø¯ÙŠ","Ù…ÙŠØ³ Ø§Ù„Ø³Ù†Ø§Ù…Ø©","Ù„Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ„","Ù„ÙŠØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø±ÙÙŠ","Ø³Ø§Ø±Ø© Ø§Ù„ØºØ§Ù…Ø¯ÙŠ"]
    };
    const PARENTS_PHONE = {
      "Ø³Ø§Ù„Ù… Ø¢Ù„ Ù…Ø®Ù„Øµ": "0502402111",
      "Ø§Ù„Ø¬ÙˆÙ‡Ø±Ø© Ø¢Ù„ Ù…Ø®Ù„Øµ": "0502402111",
      "ØªØ§Ù„ÙŠÙ† Ù…ØªÙˆÙ„ÙŠ": "0505220540",
      "Ø¬Ø§Ø¯Ù„ Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ": "0538118080",
      "Ø¯Ø§Ù†Ø© Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": "0555952003",
      "Ø±Ù‡Ù Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ": "0543339829",
      "ÙƒØ§Ø¯ÙŠ Ø§Ù„Ø¹ØªÙŠØ¨ÙŠ": "0532340737",
      "Ø±Ù‡Ù Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ": "0562580555",
      "Ø±ÙŠÙ… Ø¢Ù„ Ù…Ø´Ø±Ù": "054565589",
      "Ø¯ÙŠÙ… Ø§Ù„Ø­Ù…Ø§Ø¯ÙŠ": "0501222335",
      "Ø±ÙˆØ¯ÙŠÙ†Ø§ Ø§Ù„ØºØ±ÙŠØ¨": "0506925919",
      "Ø±Ø§ÙƒØ§Ù† Ù…Ø¨Ø§Ø±ÙƒÙŠ": "0559591061",
      "Ø³Ù„Ù…Ø§Ù† Ø§Ù„Ø¬ÙˆÙ‡Ø±": "053827904",
      "Ø·Ù„Ø§Ù„ Ø§Ù„Ø±Ø­ÙŠÙ„ÙŠ": "0598801283",
      "Ù…Ø­Ù…Ø¯ Ø¨ÙˆØµØ§Ù„Ø­": "0500125335",
      "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹Ù†Ø²ÙŠ": "0533264929",
      "Ø¹Ù„ÙŠ Ø§Ù„Ù…ÙƒØ±Ù…ÙŠ": "0563882235",
      "ÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø§Ù„ÙƒÙŠ": "0552582145",
      "Ù†Ø§ÙŠÙ Ø§Ù„Ø¹ØµÙŠÙ…ÙŠ": "0509799783",
      "Ø¹Ø¨Ø¯Ø§Ù„Ù…Ù„Ùƒ Ø§Ù„Ø¬Ù†Ø§Ø¹ÙŠ": "0568027600",
      "ÙÙŠØµÙ„ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": "0507993660",
      "Ø±ÙŠØ§Ù† Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": "0555078508",
      "Ø¹Ù…Ø± ØµÙˆØ§Ù": "0599831191",
      "Ø¯ÙŠÙ…Ø© Ø§Ù„Ø´Ù‡Ø±ÙŠ": "0567509173",
      "Ù„Ø§Ø±ÙŠÙ† Ø§Ù„ØªÙ„": "0580662141",
      "Ù†Ø¬Ù„Ø§ Ø§Ù„Ù‚Ø­Ø·Ø§Ù†ÙŠ": "0535952876",
      "Ø§ÙŠÙ…Ø§Ù† Ø¨Ø§ØºØ±ÙŠØ¨": "0542678280",
      "Ø¯ÙŠÙ… Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": "0535912049",
      "Ù„ÙŠØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø±ÙÙŠ": "0568135644",
      "Ù…ÙŠØ³ Ø§Ù„Ø³Ù†Ø§Ù…Ø©": "0580443424",
      "Ø³Ø§Ø±Ø© Ø§Ù„ØºØ§Ù…Ø¯ÙŠ": "0542743881"
    };

    let forgotPinEnabled = true;
    async function loadForgotSetting(){
      try{
        const doc = await db.collection("settings").doc("security").get();
        if(doc.exists){
          const d = doc.data() || {};
          if(typeof d.forgotPinEnabled === "boolean") forgotPinEnabled = d.forgotPinEnabled;
        }else{
          await db.collection("settings").doc("security").set({forgotPinEnabled:true});
          forgotPinEnabled = true;
        }
      }catch(e){ forgotPinEnabled = true; }
    }
    function isForgotEnabled(){ return forgotPinEnabled === true; }

    async function toggleForgotPinForAll(){
      try{
        forgotPinEnabled = !forgotPinEnabled;
        await db.collection("settings").doc("security").set({forgotPinEnabled}, {merge:true});
        openModal("ØªÙ… âœ…", forgotPinEnabled ? "ØªÙ… ØªÙØ¹ÙŠÙ„ (Ù†Ø³ÙŠØª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ) Ù„Ù„Ø¬Ù…ÙŠØ¹." : "ØªÙ… ØªØ¹Ø·ÙŠÙ„ (Ù†Ø³ÙŠØª Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ) Ù„Ù„Ø¬Ù…ÙŠØ¹.",
          '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
      }catch(e){
        openModal("ØªÙ†Ø¨ÙŠÙ‡", "ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¢Ù†.");
      }
      await loadForgotSetting();
    }

    async function ensureSeed(){
      const c = await db.collection("classes").orderBy("order").get();
      if(c.empty){
        await db.collection("classes").add({name:"Ø§Ù„ØµÙ Ø³Ø§Ø¯Ø³ Ø¨Ù†ÙŠÙ†",order:1});
        await db.collection("classes").add({name:"Ø§Ù„ØµÙ Ø³Ø§Ø¯Ø³ Ø¨Ù†Ø§Øª",order:2});
        await db.collection("classes").add({name:"Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ Ø§Ù„Ù…ØªÙˆØ³Ø·",order:3});
      }

      const c2 = await db.collection("classes").orderBy("order").get();
      const by = {};
      c2.forEach(d=>by[d.data().name]=d.id);

      const all = await db.collection("students").get();
      const existing = new Set();
      all.forEach(d=>{ const s=d.data(); if(s?.name) existing.add(String(s.name).trim()); });

      for(const clsName of Object.keys(DEFAULT_STUDENTS)){
        const classId = by[clsName] || by[("Ø§Ù„ØµÙ " + clsName)] || by[("Ø§Ù„ØµÙ " + clsName.replace("Ø£ÙˆÙ„","Ø§Ù„Ø£ÙˆÙ„"))];
        if(!classId) continue;

        for(const n0 of DEFAULT_STUDENTS[clsName]){
          const n = String(n0).trim();
          if(existing.has(n)) continue;
          const pin=String(Math.floor(1000+Math.random()*9000));
          await db.collection("students").add({
            name:n,classId,active:true,balance:0,pin,openedAt:null,
            guardianWhats:(PARENTS_PHONE[n]||"")
          });
          existing.add(n);
        }
      }
    }

    // ================== Classes ==================
    let classes=[], currentClassId=null, currentStudentId=null;
    let selectedIds = new Set();

    async function loadClasses(){
      const snap = await db.collection("classes").orderBy("order").get();
      classes=[]; snap.forEach(d=>classes.push({id:d.id,...d.data()}));
      if(!currentClassId) currentClassId = classes[0]?.id;
    }

    async function renderTabs(){
      await loadClasses();
      const tabs=$("classTabs"); if(!tabs) return;
      tabs.innerHTML="";
      classes.forEach(c=>{
        const t=document.createElement("div");
        t.className="tab"+(c.id===currentClassId?" active":"");
        t.textContent=c.name;
        t.onclick=()=>{ currentClassId=c.id; renderTabs(); };
        tabs.appendChild(t);
      });
      const c = classes.find(x=>x.id===currentClassId);
      if($("classTitle")) $("classTitle").textContent = c ? c.name : "Ø§Ù„ÙØµÙ„";
    }

    async function addClass(){
      const n=$("newClassName").value.trim();
      if(!n) return warn("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ÙØµÙ„");
      const last=await db.collection("classes").orderBy("order","desc").limit(1).get();
      const max= last.empty?0:(last.docs[0].data().order||0);
      await db.collection("classes").add({name:n,order:max+1});
      $("newClassName").value="";
      await renderTabs();
    }
    async function renameClass(){
      const c=classes.find(x=>x.id===currentClassId); if(!c) return;
      const nn=prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„Ù„ÙØµÙ„:", c.name); if(!nn) return;
      await db.collection("classes").doc(currentClassId).update({name: nn.trim()});
      await renderTabs();
    }
    async function deleteClassMove(){
      if(classes.length<=1) return warn("Ù…Ø§ Ù†Ù‚Ø¯Ø± Ù†Ø­Ø°Ù Ø¢Ø®Ø± ÙØµÙ„");
      const others=classes.filter(c=>c.id!==currentClassId);
      const destName=prompt("Ù†Ù†Ù‚Ù„ Ø·Ù„Ø§Ø¨ Ø§Ù„ÙØµÙ„ Ù„Ø£ÙŠ ÙØµÙ„?\\n"+others.map(c=>c.name).join(" / "), others[0].name);
      if(!destName) return;
      const dest=classes.find(c=>c.name===destName); if(!dest) return warn("Ø§Ø³Ù… Ø§Ù„ÙØµÙ„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
      const studs=await db.collection("students").where("classId","==",currentClassId).get();
      const batch=db.batch();
      studs.forEach(d=>batch.update(db.collection("students").doc(d.id), {classId: dest.id}));
      batch.delete(db.collection("classes").doc(currentClassId));
      await batch.commit();
      currentClassId=null;
      await renderTabs();
    }
    async function syncStudentsToClasses(){
      await ensureSeed();
      openModal("ØªÙ… âœ…","ØªÙ… ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ (Ø£Ùˆ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ø§Ù‚Øµ).",'<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
      await renderTabs();
    }

    // ================== Teacher login ==================
    function teacherLogin(){
      if(($("tu").value||"").trim()==="teacher" && ($("tp").value||"").trim()==="12345"){
        currentAccess="teacher";
        hideAllPages();
        show("classesPage");
        renderTabs();
      } else warn("Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ ØºÙŠØ± ØµØ­ÙŠØ­Ø©");
    }
    function forgotTeacher(){
      const subject=encodeURIComponent("Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª");
      const body=encodeURIComponent("Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ…ØŒ\\nØ£Ø±ØºØ¨ Ø¨Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª.\\nØ´ÙƒØ±Ø§Ù‹.");
      window.location.href=`mailto:${TEACHER_EMAIL}?subject=${subject}&body=${body}`;
    }

    // ================== Student login ==================
    async function forgotStudentPin(){
      if(!isForgotEnabled()){
        openModal("ØªÙ†Ø¨ÙŠÙ‡","Ø®Ø¯Ù…Ø© Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ Ù…ÙˆÙ‚ÙˆÙØ© Ù…Ø¤Ù‚ØªÙ‹Ø§. Ø±Ø§Ø¬Ø¹/ÙŠ Ø§Ù„Ù…Ø¹Ù„Ù…Ø© ğŸŒ¿");
        return;
      }
      const name = ($("stuName")?.value || "").trim();
      if(!name) return warn("Ø§ÙƒØªØ¨/ÙŠ Ø§Ù„Ø§Ø³Ù… Ø£ÙˆÙ„Ø§Ù‹");
      const snap = await db.collection("students").where("name","==",name).limit(1).get();
      if(snap.empty) return warn("Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯");
      const doc = snap.docs[0];
      const s = doc.data() || {};
      const parent = s.guardianWhats || (PARENTS_PHONE[s.name]||"");
      const wa = normalizePhoneToWA(parent);
      if(!wa) return openModal("ØªÙ†Ø¨ÙŠÙ‡","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø£Ù…Ø± Ù…Ø³Ø¬Ù„. ØªÙˆØ§ØµÙ„/ÙŠ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©.");
      const msg =
        "âš ï¸ Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©\\n" + TEACHER_BANK_TITLE + "\\n\\n" +
        "Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ (PIN) Ù„Ù„Ø·Ø§Ù„Ø¨/Ù€Ø©:\\n" + (s.name||"") + "\\n" +
        "PIN: " + (s.pin||"") + "\\n\\n" +
        "Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©:\\n" + contactLink() + "\\n\\n" + SIGNATURE;

      openWA(wa, msg);
    }

    async function studentLogin(){
      try{
        currentAccess="student";
        const name = ($("stuName")?.value || "").trim();
        const pin  = ($("stuPin")?.value || "").trim();
        if(!name || !pin) return warn("Ø§ÙƒØªØ¨/ÙŠ Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ");

        const snap = await db.collection("students").where("name","==",name).limit(1).get();
        if(snap.empty) return warn("Ø§Ù„Ø§Ø³Ù… ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø¨Ø§Ù„Ù†Ø¸Ø§Ù…");
        const doc = snap.docs[0];
        currentStudentId = doc.id;
        const s = doc.data() || {};

        if(!s.active) return warn("Ø§Ù„Ø­Ø³Ø§Ø¨ Ù…Ù‚ÙÙ„");
        if(String(pin) !== String(s.pin||"")) return warn("Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ ØºÙ„Ø·");
        if(!s.openedAt) await db.collection("students").doc(currentStudentId)
          .update({openedAt: firebase.firestore.FieldValue.serverTimestamp()});

        await playWelcome();

        await openStudentAccount(s);
      }catch(e){
        console.log(e);
        warn("ØµØ§Ø± Ø®Ø·Ø£â€¦ Ø¬Ø±Ù‘Ø¨ÙŠ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©");
      }
    }

    function calcTier(balance){
      const b = Number(balance||0);
      if(b >= 500) return "ğŸ’ Ø£Ù„Ù…Ø§Ø³ÙŠ";
      if(b >= 300) return "ğŸ”· Ù…Ø§Ø³ÙŠ";
      if(b >= 150) return "ğŸ¥‡ Ø°Ù‡Ø¨ÙŠ";
      if(b >= 70)  return "ğŸ¥ˆ ÙØ¶ÙŠ";
      return "ğŸ¥‰ Ø¨Ø±ÙˆÙ†Ø²ÙŠ";
    }

    function makeBankCardNumber(studentId){
      // produce deterministic-ish 16 digits from doc id
      const raw = String(studentId||"").replace(/[^a-zA-Z0-9]/g,"");
      let digits = "";
      for(let i=0;i<raw.length;i++){
        const c = raw.charCodeAt(i);
        digits += String((c % 10));
      }
      while(digits.length < 16) digits += String(Math.floor(Math.random()*10));
      digits = digits.slice(0,16);
      return digits.replace(/(.{4})/g,"$1 ").trim();
    }

    function makeAccountNumber(studentId){
      const raw = String(studentId||"").slice(0,10).toUpperCase();
      let out = raw.replace(/[^A-Z0-9]/g,"");
      while(out.length < 10) out += String(Math.floor(Math.random()*10));
      return "MB-" + out;
    }

    function makeExp(){
      const d = new Date();
      const mm = String(((d.getMonth()+1)+11)%12 + 1).padStart(2,'0'); // 12 months ahead-ish
      const yy = String((d.getFullYear()+1)%100).padStart(2,'0');
      return mm + "/" + yy;
    }

    async function renderOpenedAt(){
      const doc=await db.collection("students").doc(currentStudentId).get();
      const s=doc.data() || {};
      $("openedAt").textContent = (s.openedAt && s.openedAt.toDate) ? s.openedAt.toDate().toLocaleString("ar-SA") : "â€”";
    }

    async function buildTransferList(){
      const snap=await db.collection("students").get();
      const arr=[]; snap.forEach(d=>arr.push({id:d.id,...d.data()}));
      arr.sort((a,b)=>(a.name||"").localeCompare(b.name||"","ar"));
      $("transferTo").innerHTML="";
      arr.forEach(s=>{ if(s.id===currentStudentId) return; const o=document.createElement("option"); o.value=s.id; o.textContent=s.name; $("transferTo").appendChild(o); });
    }

    async function openStudentAccount(s){
      hideAllPages();
      show("studentAccountPage");

      $("studentHeader").textContent = s.name || "â€”";
      $("studentSub").textContent = "Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ â€“ ÙˆØ§Ø¬Ù‡Ø© Ø¨Ù†ÙƒÙŠØ©";
      $("statusBadge").className = "badge " + (s.active ? "on":"off");
      $("statusBadge").textContent = s.active ? "ğŸŸ¢ Ù†Ø´Ø·" : "ğŸ”´ Ù…Ù‚ÙÙ„";
      $("studentBalance").textContent = fmt(s.balance);
      const tier = s.tier || calcTier(s.balance);
      $("tierLabel").textContent = tier;

      // Card details
      const cardNum = makeBankCardNumber(currentStudentId);
      const exp = makeExp();
      $("cardNumber").textContent = cardNum;
      $("cardPin").textContent = "â€¢â€¢â€¢â€¢";
      $("cardAcc").textContent = makeAccountNumber(currentStudentId);
      $("cardHolder").textContent = (s.name || "â€”").toUpperCase();

      $("detailName").textContent = s.name || "â€”";
      $("detailAcc").textContent = makeAccountNumber(currentStudentId);
      $("detailExp").textContent = exp;
      $("detailPin").textContent = String(s.pin || "â€”");

      await renderOpenedAt();
      await buildTransferList();

      setupReasonUI($("op").value,'reasonStudent','reasonOtherStudent');
      await showStatement();
      await refreshWeekKPIs();
    }

    function backAfterStudent(){
      // if student entered via link => back to student login; else teacher flow returns to class page
      if(currentAccess === "student"){
        hideAllPages();
        show("studentLoginPage");
        return;
      }
      hideAllPages();
      show("classPage");
      renderStudents();
    }

    function setMiniTab(paneId, el){
      document.querySelectorAll(".miniTab").forEach(t=>t.classList.remove("active"));
      el.classList.add("active");
      document.querySelectorAll(".miniPane").forEach(p=>p.classList.remove("active"));
      $(paneId).classList.add("active");
    }

    // ================== Teacher -> open class ==================
    function backToClasses(){ hideAllPages(); show("classesPage"); renderTabs(); }
    async function openClassPage(){
      hideAllPages();
      show("classPage");
      selectedIds.clear();
      if($("selAll")) $("selAll").checked=false;
      await renderTabs();
      await renderStudents();
      initTeacherReasonAlways();
    }

    // ================== Student list (teacher) ==================
    async function addStudent(){
      const n=$("newStudentName").value.trim();
      if(!n) return warn("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨");
      const pin=String(Math.floor(1000+Math.random()*9000));
      await db.collection("students").add({
        name:n,classId:currentClassId,active:true,balance:0,pin,openedAt:null,
        guardianWhats:(PARENTS_PHONE[n]||"")
      });
      $("newStudentName").value="";
      await renderStudents();
    }

    function updateSelCount(){
      const el = $("selCount");
      if(el) el.textContent = "Ø§Ù„Ù…Ø­Ø¯Ø¯: " + selectedIds.size;
    }
    function toggleSelectAll(){
      const all = $("selAll")?.checked;
      document.querySelectorAll('input[data-sel="stu"]').forEach(cb=>{
        cb.checked = !!all;
        const id = cb.getAttribute("data-id");
        if(all) selectedIds.add(id); else selectedIds.delete(id);
      });
      updateSelCount();
    }

    async function deleteStudent(studentId, studentName){
      if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ø·Ø§Ù„Ø¨: " + studentName + " ØŸ")) return;
      try{
        const sref = db.collection("students").doc(studentId);
        const tx = await sref.collection("txns").limit(300).get();
        const batch = db.batch();
        tx.forEach(d=>batch.delete(d.ref));
        batch.delete(sref);
        await batch.commit();
      }catch(e){
        try{ await db.collection("students").doc(studentId).delete(); }catch(_){}
      }
      selectedIds.delete(studentId);
      updateSelCount();
      await renderStudents();
    }

    async function renderStudents(){
      const snap = await db.collection("students").where("classId","==",currentClassId).get();
      const arr=[]; snap.forEach(d=>arr.push({id:d.id,...d.data()}));
      arr.sort((a,b)=>(a.name||"").localeCompare(b.name||"","ar"));

      const pick = $("pickStudent");
      if(pick){
        pick.innerHTML="";
        arr.forEach(s=>{
          const o=document.createElement("option");
          o.value=s.id; o.textContent=s.name;
          pick.appendChild(o);
        });
      }

      const grid = $("studentsGrid");
      if(!grid) return;
      grid.innerHTML="";

      arr.forEach(s=>{
        const card = document.createElement("div");
        card.className="card";
        const isChecked = selectedIds.has(s.id);
        const tierText = (s.tier || calcTier(s.balance)) || "";

        card.innerHTML = `
          <div class="row" style="align-items:center;justify-content:space-between">
            <div style="display:flex;gap:10px;align-items:center">
              <label class="small" style="display:flex;gap:8px;align-items:center">
                <input type="checkbox" data-sel="stu" data-id="${s.id}" ${isChecked?'checked':''} style="width:auto"> Ø§Ø®ØªÙŠØ§Ø±
              </label>
              <span class="badge ${s.active?'on':'off'}">${s.active?'ğŸŸ¢ Ù…ÙØ¹Ù„':'ğŸ”´ Ù…Ù‚ÙÙ„'}</span>
            </div>
            <div class="small" style="font-weight:1000;color:#0b2a66">${tierText}</div>
          </div>

          <div style="margin-top:8px">
            <strong>${s.name || ""}</strong>
            <div class="small">Ø§Ù„Ø±ØµÙŠØ¯: ${fmt(s.balance)} Ø±.Ø³</div>
            <div class="small">PIN: <b>${s.pin||""}</b></div>
          </div>

          <div class="row" style="margin-top:10px">
            <button class="btn2 col js-open">Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ø§Ù„Ø¨</button>
            <button class="btn3 col js-toggle">${s.active?'Ø¥Ù‚ÙØ§Ù„':'ØªÙØ¹ÙŠÙ„'}</button>
            <button class="btn3 col js-edit">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø§Ø³Ù…</button>
            <button class="whatsapp-btn col js-sendpin">Ø¥Ø±Ø³Ø§Ù„ PIN</button>
            <button class="btn2 col js-pdf">ØªÙ‚Ø±ÙŠØ± PDF</button>
            <button class="btnRed col js-del">Ø­Ø°Ù</button>
          </div>
        `;

        const cb = card.querySelector('input[data-sel="stu"]');
        cb.onchange = ()=>{
          if(cb.checked) selectedIds.add(s.id);
          else selectedIds.delete(s.id);
          updateSelCount();
        };

        card.querySelector(".js-open").onclick = async()=>{
          currentAccess="teacher";
          currentStudentId=s.id;
          await openStudentAccount(s);
        };
        card.querySelector(".js-toggle").onclick = async()=>{
          await db.collection("students").doc(s.id).update({active:!s.active});
          await renderStudents();
        };
        card.querySelector(".js-edit").onclick = async()=>{
          const nn = prompt("Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø¬Ø¯ÙŠØ¯:", s.name);
          if(nn) await db.collection("students").doc(s.id).update({name:nn.trim()});
          await renderStudents();
        };
        card.querySelector(".js-sendpin").onclick = ()=> sendPinToParent(s.id);
        card.querySelector(".js-pdf").onclick = ()=> downloadWeeklyStudentPDFForId(s.id);
        card.querySelector(".js-del").onclick = ()=> deleteStudent(s.id, s.name);

        grid.appendChild(card);
      });

      updateSelCount();
    }

    // ================== Parent phone + PIN ==================
    async function ensureGuardianPhone(studentId, studentName){
      const ref = db.collection("students").doc(studentId);
      const doc = await ref.get();
      if(!doc.exists) return "";
      const s = doc.data() || {};
      if(s.guardianWhats && String(s.guardianWhats).trim()) return String(s.guardianWhats).trim();
      const guess = PARENTS_PHONE[studentName] || "";
      if(guess){
        await ref.update({guardianWhats: guess});
        return guess;
      }
      return "";
    }

    async function sendPinToParent(studentId){
      const ref = db.collection("students").doc(studentId);
      const doc = await ref.get();
      if(!doc.exists) return;
      const s = doc.data() || {};
      const parent = await ensureGuardianPhone(studentId, s.name||"");
      const wa = normalizePhoneToWA(parent);
      if(!wa){
        openModal("ØªÙ†Ø¨ÙŠÙ‡", "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø£Ù…Ø± Ù…Ø³Ø¬Ù„.", '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
        return;
      }
      const msg =
        "âš ï¸ Ø±Ø³Ø§Ù„Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©\\n" +
        TEACHER_BANK_TITLE + "\\n\\n" +
        "Ø±Ù‚Ù… Ø§Ù„Ø¯Ø®ÙˆÙ„ (PIN) Ù„Ù„Ø·Ø§Ù„Ø¨/Ù€Ø©:\\n" + (s.name||"") + "\\n" +
        "PIN: " + (s.pin||"") + "\\n\\n" +
        "Ù„Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©:\\n" + contactLink() + "\\n\\n" +
        SIGNATURE;

      openWA(wa, msg);
    }

    // ================== Txn log ==================
    function localDateKeyFromDate(d){
      const yyyy = d.getFullYear();
      const mm = String(d.getMonth()+1).padStart(2,'0');
      const dd = String(d.getDate()).padStart(2,'0');
      return `${yyyy}-${mm}-${dd}`;
    }
    function localTodayKey(){ return localDateKeyFromDate(new Date()); }

    async function logTxn(ref, type, reason, amount, balanceAfter, studentName, guardianWhats){
      const dateKey = localTodayKey();
      const createdAtClient = Date.now();

      await ref.collection("txns").add({
        type,
        reason: reason || "",
        amount,
        balanceAfter,
        studentName: studentName || "",
        guardianWhats: guardianWhats || "",
        dateKey,
        createdAtClient,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
    }

    async function smartAutoSendWhats({type, studentName, amount, reason, guardianWhats}){
      if(!isAutoWAEnabled()) return;

      const parent = normalizePhoneToWA(guardianWhats || "");
      if(!parent){
        openModal("ØªÙ†Ø¨ÙŠÙ‡","Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø±Ù‚Ù… ÙˆÙ„ÙŠ Ø£Ù…Ø± Ù…Ø³Ø¬Ù„ Ù„Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.", '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
        return;
      }

      const msg = buildOfficialMessage(type, studentName, amount, reason);
      openWA(parent, msg);

      if(isCopyEnabled()){
        setTimeout(()=>{
          openWA(CONTACT_PRIMARY, "Ù†Ø³Ø®Ø© Ù„Ù„Ù…Ø¹Ù„Ù…Ø© âœ…\\n\\n" + msg);
        }, 1200);
      }
    }

    // ================== Teacher ops ==================
    async function depositAll(){
      const a=parseFloat($("bulkAmount").value);
      if(isNaN(a)||a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„ÙƒÙ„");
      const studs=await db.collection("students").where("classId","==",currentClassId).get();

      const batch=db.batch();
      for(const d of studs.docs){
        const s=d.data(); if(!s.active) continue;
        batch.update(db.collection("students").doc(d.id), {balance:Number(s.balance||0)+a});
      }
      await batch.commit();

      for(const d of studs.docs){
        const s=d.data(); if(!s.active) continue;
        const reason = getReason("reasonTeacher","reasonOtherTeacher");
        await logTxn(db.collection("students").doc(d.id),"Ø¥ÙŠØ¯Ø§Ø¹ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,Number(s.balance||0)+a,s.name,s.guardianWhats||"");
        await smartAutoSendWhats({type:"Ø¥ÙŠØ¯Ø§Ø¹", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});
      }
      $("bulkAmount").value="";
      await renderStudents();
    }

    async function withdrawAll(){
      const a=parseFloat($("bulkWithdrawAmount").value);
      if(isNaN(a)||a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº Ø§Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„ÙƒÙ„");
      const studs=await db.collection("students").where("classId","==",currentClassId).get();

      for(const d of studs.docs){
        const s=d.data(); if(!s.active) continue;
        if(Number(s.balance||0) < a) return warn("ÙÙŠ Ø·Ø§Ù„Ø¨ Ø±ØµÙŠØ¯Ù‡ Ù…Ø§ ÙŠÙƒÙÙŠâ€¦ Ù‚Ù„Ù„ Ø§Ù„Ù…Ø¨Ù„Øº");
      }

      const batch=db.batch();
      for(const d of studs.docs){
        const s=d.data(); if(!s.active) continue;
        batch.update(db.collection("students").doc(d.id), {balance:Number(s.balance||0)-a});
      }
      await batch.commit();

      for(const d of studs.docs){
        const s=d.data(); if(!s.active) continue;
        const reason = getReason("reasonTeacher","reasonOtherTeacher");
        await logTxn(db.collection("students").doc(d.id),"Ø³Ø­Ø¨ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,Number(s.balance||0)-a,s.name,s.guardianWhats||"");
        await smartAutoSendWhats({type:"Ø³Ø­Ø¨", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});
      }
      $("bulkWithdrawAmount").value="";
      await renderStudents();
    }

    async function depositToStudent(){
      const sid = $("pickStudent").value;
      const a = parseFloat($("pickAmount").value);
      if(!sid) return warn("Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨");
      if(isNaN(a) || a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº");

      const ref = db.collection("students").doc(sid);
      const doc = await ref.get();
      const s = doc.data();
      if(!s.active) return warn("Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù‚ÙÙ„");

      const nb = Number(s.balance||0) + a;
      const reason = getReason("reasonTeacher","reasonOtherTeacher");
      await ref.update({balance: nb});
      await logTxn(ref,"Ø¥ÙŠØ¯Ø§Ø¹ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,nb,s.name,s.guardianWhats||"");
      await smartAutoSendWhats({type:"Ø¥ÙŠØ¯Ø§Ø¹", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});

      $("pickAmount").value = "";
      await renderStudents();
    }

    async function withdrawFromStudent(){
      const sid = $("pickStudent").value;
      const a = parseFloat($("pickAmount").value);
      if(!sid) return warn("Ø§Ø®ØªØ± Ø·Ø§Ù„Ø¨");
      if(isNaN(a) || a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº");

      const ref = db.collection("students").doc(sid);
      const doc = await ref.get();
      const s = doc.data();
      if(!s.active) return warn("Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ Ù…Ù‚ÙÙ„");
      if(Number(s.balance||0) < a) return warn("Ø±ØµÙŠØ¯Ù‡ Ù…Ø§ ÙŠÙƒÙÙŠ");

      const nb = Number(s.balance||0) - a;
      const reason = getReason("reasonTeacher","reasonOtherTeacher");
      await ref.update({balance: nb});
      await logTxn(ref,"Ø³Ø­Ø¨ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,nb,s.name,s.guardianWhats||"");
      await smartAutoSendWhats({type:"Ø³Ø­Ø¨", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});

      $("pickAmount").value = "";
      await renderStudents();
    }

    async function depositSelected(){
      const a = parseFloat($("pickAmount").value);
      if(isNaN(a) || a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº (ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø¨Ù„Øº) Ù„Ù„Ø¥ÙŠØ¯Ø§Ø¹ Ù„Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†");
      if(selectedIds.size===0) return warn("Ù…Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ù„Ø§Ø¨");

      const reason = getReason("reasonTeacher","reasonOtherTeacher");

      for(const sid of selectedIds){
        const ref = db.collection("students").doc(sid);
        const doc = await ref.get();
        if(!doc.exists) continue;
        const s = doc.data();
        if(!s.active) continue;
        const nb = Number(s.balance||0) + a;
        await ref.update({balance: nb});
        await logTxn(ref,"Ø¥ÙŠØ¯Ø§Ø¹ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,nb,s.name,s.guardianWhats||"");
        await smartAutoSendWhats({type:"Ø¥ÙŠØ¯Ø§Ø¹", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});
      }
      await renderStudents();
    }

    async function withdrawSelected(){
      const a = parseFloat($("pickAmount").value);
      if(isNaN(a) || a<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº (ÙÙŠ Ø®Ø§Ù†Ø© Ø§Ù„Ù…Ø¨Ù„Øº) Ù„Ù„Ø³Ø­Ø¨ Ù…Ù† Ø§Ù„Ù…Ø­Ø¯Ø¯ÙŠÙ†");
      if(selectedIds.size===0) return warn("Ù…Ø§ ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø·Ù„Ø§Ø¨");

      const reason = getReason("reasonTeacher","reasonOtherTeacher");

      for(const sid of selectedIds){
        const ref = db.collection("students").doc(sid);
        const doc = await ref.get();
        if(!doc.exists) continue;
        const s = doc.data();
        if(!s.active) continue;
        if(Number(s.balance||0) < a) continue;
        const nb = Number(s.balance||0) - a;
        await ref.update({balance: nb});
        await logTxn(ref,"Ø³Ø­Ø¨ (Ù…Ø¹Ù„Ù…Ø©)",reason,a,nb,s.name,s.guardianWhats||"");
        await smartAutoSendWhats({type:"Ø³Ø­Ø¨", studentName:s.name, amount:a, reason, guardianWhats:(s.guardianWhats||"")});
      }
      await renderStudents();
    }

    // ================== Statement ==================
    async function showStatement(){
      const from=$("fromDate").value;
      const to=$("toDate").value;

      let q = db.collection("students").doc(currentStudentId).collection("txns")
        .orderBy("createdAtClient","desc").limit(80);

      if(from && to){
        const fromMs = new Date(from + "T00:00:00").getTime();
        const toMs   = new Date(to   + "T23:59:59").getTime();

        q = db.collection("students").doc(currentStudentId).collection("txns")
          .where("createdAtClient", ">=", fromMs)
          .where("createdAtClient", "<=", toMs)
          .orderBy("createdAtClient","desc")
          .limit(250);
      }

      const snap=await q.get();
      const rows=$("stmtRows"); rows.innerHTML="";
      if(snap.empty){
        rows.innerHTML='<tr><td colspan="5" class="small">Ù…Ø§ ÙÙŠÙ‡ Ø¹Ù…Ù„ÙŠØ§Øª Ø¨Ù‡Ø§Ù„ÙØªØ±Ø©â€¦</td></tr>';
        return;
      }
      snap.forEach(d=>{
        const x=d.data();
        const t=x.createdAtClient ? new Date(x.createdAtClient).toLocaleString("ar-SA") : "";
        const tr=document.createElement("tr");
        tr.innerHTML=`<td>${t}</td><td>${x.type||""}</td><td>${x.reason||""}</td><td>${fmt(x.amount)}</td><td>${fmt(x.balanceAfter)}</td>`;
        rows.appendChild(tr);
      });
    }

    async function executeOp(){
      const ref=db.collection("students").doc(currentStudentId);
      const doc=await ref.get();
      const s=doc.data();
      const op=$("op").value;
      const amt=parseFloat($("amt").value);

      if(isNaN(amt) || amt<=0) return warn("Ø§ÙƒØªØ¨ Ù…Ø¨Ù„Øº ØµØ­ÙŠØ­");
      const reason = getReason("reasonStudent","reasonOtherStudent");

      if(op==="deposit"){
        const nb=Number(s.balance||0)+amt;
        await ref.update({balance:nb});
        await logTxn(ref, "Ø¥ÙŠØ¯Ø§Ø¹", reason, amt, nb, s.name, s.guardianWhats||"");
      }else if(op==="withdraw"){
        if(Number(s.balance||0) < amt) return warn("Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø§ ÙŠÙƒÙÙŠ");
        const nb=Number(s.balance||0)-amt;
        await ref.update({balance:nb});
        await logTxn(ref, "Ø³Ø­Ø¨", reason, amt, nb, s.name, s.guardianWhats||"");
      }else if(op==="transfer"){
        if(Number(s.balance||0) < amt) return warn("Ø§Ù„Ø±ØµÙŠØ¯ Ù…Ø§ ÙŠÙƒÙÙŠ Ù„Ù„ØªØ­ÙˆÙŠÙ„");
        const toId=$("transferTo").value;
        const toRef=db.collection("students").doc(toId);
        const toDoc=await toRef.get();
        if(!toDoc.exists) return warn("Ø§Ù„Ù…Ø³ØªÙ„Ù… Ù…Ùˆ Ù…ÙˆØ¬ÙˆØ¯");
        const to=toDoc.data();

        const batch=db.batch();
        batch.update(ref, {balance:Number(s.balance||0)-amt});
        batch.update(toRef, {balance:Number(to.balance||0)+amt});
        await batch.commit();

        await logTxn(ref, "ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ "+to.name, reason, amt, Number(s.balance||0)-amt, s.name, s.guardianWhats||"");
        await logTxn(toRef, "ØªØ­ÙˆÙŠÙ„ Ù…Ù† "+(s.name||"Ø·Ø§Ù„Ø¨"), reason, amt, Number(to.balance||0)+amt, to.name, to.guardianWhats||"");
      }

      $("amt").value="";
      const updated=await ref.get();
      $("studentBalance").textContent=fmt(updated.data().balance);
      $("tierLabel").textContent = calcTier(updated.data().balance);

      setupReasonUI($("op").value,'reasonStudent','reasonOtherStudent');
      await showStatement();
      await refreshWeekKPIs();
    }

    // ================== Stats (simple) ==================
    function getWeekRange(endStr){
      const end = endStr ? new Date(endStr+"T23:59:59") : new Date();
      const day = end.getDay();
      const diffToSat = (day - 6 + 7) % 7;
      end.setDate(end.getDate() - diffToSat);

      const start = new Date(end);
      start.setDate(end.getDate() - 6);
      start.setHours(0,0,0,0);

      const end2 = new Date(end);
      end2.setHours(23,59,59,999);
      return { startMs: start.getTime(), endMs: end2.getTime() };
    }

    async function refreshWeekKPIs(){
      const {startMs,endMs} = getWeekRange("");
      const q = db.collection("students").doc(currentStudentId).collection("txns")
        .where("createdAtClient", ">=", startMs)
        .where("createdAtClient", "<=", endMs)
        .orderBy("createdAtClient","desc")
        .limit(400);

      const snap = await q.get();
      let dep=0,wit=0,count=0;
      snap.forEach(d=>{
        const x=d.data()||{};
        count++;
        const a=Number(x.amount||0);
        const t=String(x.type||"");
        if(t.includes("Ø¥ÙŠØ¯Ø§Ø¹")) dep += a;
        else if(t.includes("Ø³Ø­Ø¨")) wit += a;
      });
      const net = dep - wit;
      $("kpiWeekCount").textContent = String(count);
      $("kpiWeekDep").textContent = fmt(dep);
      $("kpiWeekWith").textContent = fmt(wit);
      $("kpiWeekNet").textContent = fmt(net);
    }

    // ================== PDF (fixed: always render visible in offscreen container) ==================
    async function elementToPDF(el, filename){
      const opt = {
        margin: [8,8,8,8],
        filename,
        image: { type: "jpeg", quality: 0.98 },
        html2canvas: { scale: 2, useCORS: true, backgroundColor:"#ffffff" },
        jsPDF: { unit: "mm", format: "a4", orientation: "portrait" }
      };
      await new Promise(r=>setTimeout(r,120));
      await html2pdf().set(opt).from(el).save();
    }

    async function buildStudentStatementPaper(){
      const studDoc = await db.collection("students").doc(currentStudentId).get();
      const s = studDoc.data() || {};
      const tier = s.tier || calcTier(s.balance);

      // get recent statement (limit 120)
      const snap = await db.collection("students").doc(currentStudentId).collection("txns")
        .orderBy("createdAtClient","desc").limit(120).get();

      let rowsHtml="";
      snap.forEach(d=>{
        const x=d.data()||{};
        const t=x.createdAtClient ? new Date(x.createdAtClient).toLocaleString("ar-SA") : "";
        rowsHtml += `<tr>
          <td>${t}</td>
          <td>${x.type||""}</td>
          <td>${x.reason||""}</td>
          <td>${fmt(x.amount)}</td>
          <td>${fmt(x.balanceAfter)}</td>
        </tr>`;
      });

      const paper = document.createElement("div");
      paper.className="pdfPaper";
      paper.innerHTML = `
        <div class="pdfHead">
          <div class="pdfBrand">
            <div class="pdfLogo"><img src="logo.png" alt="logo"></div>
            <div>
              <div class="pdfTitle">ÙƒØ´Ù Ø­Ø³Ø§Ø¨ Ø§Ù„Ø·Ø§Ù„Ø¨ â€“ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
              <div class="pdfSub">Ù…Ø¯Ø±Ø³Ø© Ø±ÙˆØ§Ø¯ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£Ù‡Ù„ÙŠØ© â€¢ ${SIGNATURE}</div>
              <div class="pdfSub">Ø§Ù„Ø·Ø§Ù„Ø¨: <b>${s.name||"â€”"}</b> â€¢ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨: <b>${tier}</b> â€¢ Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ: <b>${fmt(s.balance)}</b> Ø±.Ø³</div>
            </div>
          </div>
          <div class="seal">BANK<br>SEAL</div>
        </div>

        <hr style="border:0;border-top:1px solid #e5e7eb;margin:12px 0">

        <div class="tableWrap">
          <table>
            <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th></tr></thead>
            <tbody>
              ${rowsHtml || `<tr><td colspan="5" style="padding:18px;color:#6b7280;font-weight:900">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª.</td></tr>`}
            </tbody>
          </table>
        </div>

        <div class="sigRow">
          <div class="sigBox">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©<br>${SIGNATURE}</div>
          <div class="sigBox" style="text-align:left;direction:ltr">Date<br>${new Date().toLocaleDateString("ar-SA")}</div>
        </div>
      `;
      return paper;
    }

    async function downloadStudentStatementPDF(){
      try{
        const temp = $("pdfTemp");
        temp.innerHTML="";
        const paper = await buildStudentStatementPaper();
        temp.appendChild(paper);
        await elementToPDF(paper, `Statement_${($("studentHeader").textContent||"student").replace(/\\s+/g,"_")}.pdf`);
        temp.innerHTML="";
      }catch(e){
        console.log(e);
        openModal("ØªÙ†Ø¨ÙŠÙ‡","ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF Ø§Ù„Ø¢Ù†. ØªØ£ÙƒØ¯/ÙŠ Ù…Ù† Ø§Ù„Ø³Ù…Ø§Ø­ Ø¨ÙØªØ­ Ø§Ù„Ù†ÙˆØ§ÙØ° Ø£Ùˆ Ø¬Ø±Ø¨/ÙŠ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.",
          '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
      }
    }

    // weekly PDF for teacher list
    async function buildWeeklyStudentPaperFor(studentId, endStr){
      const {startMs, endMs} = getWeekRange(endStr);
      const studDoc = await db.collection("students").doc(studentId).get();
      if(!studDoc.exists) throw new Error("Student not found");
      const s = studDoc.data() || {};
      const tier = s.tier || calcTier(s.balance);

      const q = db.collection("students").doc(studentId).collection("txns")
        .where("createdAtClient", ">=", startMs)
        .where("createdAtClient", "<=", endMs)
        .orderBy("createdAtClient","desc")
        .limit(400);

      const snap = await q.get();
      let dep=0,wit=0,tr=0,count=0;
      const rows = [];
      snap.forEach(d=>{
        const x=d.data()||{};
        count++;
        const a=Number(x.amount||0);
        const t=String(x.type||"");
        if(t.includes("Ø¥ÙŠØ¯Ø§Ø¹")) dep += a;
        else if(t.includes("Ø³Ø­Ø¨")) wit += a;
        else if(t.includes("ØªØ­ÙˆÙŠÙ„")) tr += a;
        const time = x.createdAtClient ? new Date(x.createdAtClient).toLocaleString("ar-SA") : "";
        rows.push(`<tr><td>${time}</td><td>${x.type||""}</td><td>${x.reason||""}</td><td>${fmt(x.amount)}</td><td>${fmt(x.balanceAfter)}</td></tr>`);
      });
      const net = dep - wit;

      const paper = document.createElement("div");
      paper.className="pdfPaper";
      paper.innerHTML = `
        <div class="pdfHead">
          <div class="pdfBrand">
            <div class="pdfLogo"><img src="logo.png" alt="logo"></div>
            <div>
              <div class="pdfTitle">Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ â€“ Ø¨Ù†Ùƒ Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ§Øª</div>
              <div class="pdfSub">Ù…Ø¯Ø±Ø³Ø© Ø±ÙˆØ§Ø¯ Ø§Ù„Ø´Ø±Ù‚ Ø§Ù„Ø£Ù‡Ù„ÙŠØ© â€¢ ${SIGNATURE}</div>
              <div class="pdfSub">Ø§Ù„Ø·Ø§Ù„Ø¨: <b>${s.name||"â€”"}</b> â€¢ Ù†ÙˆØ¹ Ø§Ù„Ø­Ø³Ø§Ø¨: <b>${tier}</b></div>
            </div>
          </div>
          <div class="seal">BANK<br>SEAL</div>
        </div>

        <hr style="border:0;border-top:1px solid #e5e7eb;margin:12px 0">

        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:10px">
          <div class="card soft" style="margin:0"><div class="small">Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${count}</div></div>
          <div class="card soft" style="margin:0"><div class="small">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ¯Ø§Ø¹</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${fmt(dep)}</div></div>
          <div class="card soft" style="margin:0"><div class="small">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø³Ø­Ø¨</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${fmt(wit)}</div></div>
          <div class="card soft" style="margin:0"><div class="small">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ÙˆÙŠÙ„Ø§Øª</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${fmt(tr)}</div></div>
          <div class="card soft" style="margin:0"><div class="small">Ø§Ù„ØµØ§ÙÙŠ</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${fmt(net)}</div></div>
          <div class="card soft" style="margin:0"><div class="small">Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ø­Ø§Ù„ÙŠ</div><div style="font-weight:1000;color:#0b2a66;font-size:18px">${fmt(s.balance)}</div></div>
        </div>

        <hr style="border:0;border-top:1px solid #e5e7eb;margin:12px 0">

        <div class="tableWrap">
          <table>
            <thead><tr><th>Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th><th>Ø§Ù„Ø³Ø¨Ø¨</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>Ø§Ù„Ø±ØµÙŠØ¯ Ø¨Ø¹Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©</th></tr></thead>
            <tbody>
              ${rows.slice(0,120).join("") || `<tr><td colspan="5" style="padding:18px;color:#6b7280;font-weight:900">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª.</td></tr>`}
            </tbody>
          </table>
        </div>

        <div class="sigRow">
          <div class="sigBox">ØªÙˆÙ‚ÙŠØ¹ Ø§Ù„Ù…Ø¹Ù„Ù…Ø©<br>${SIGNATURE}</div>
          <div class="sigBox" style="text-align:left;direction:ltr">Date<br>${new Date().toLocaleDateString("ar-SA")}</div>
        </div>
      `;
      return paper;
    }

    async function downloadWeeklyStudentPDFForId(studentId){
      try{
        const temp = $("pdfTemp");
        temp.innerHTML="";
        const paper = await buildWeeklyStudentPaperFor(studentId,"");
        temp.appendChild(paper);
        const studDoc = await db.collection("students").doc(studentId).get();
        const s = studDoc.data() || {};
        const name = (s.name || "student").replace(/\\s+/g,"_");
        await elementToPDF(paper, `Weekly_Report_${name}.pdf`);
        temp.innerHTML="";
      }catch(e){
        console.log(e);
        openModal("ØªÙ†Ø¨ÙŠÙ‡","ØªØ¹Ø°Ø± Ø¥Ù†Ø´Ø§Ø¡ PDF Ù„Ù‡Ø°Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø§Ù„Ø¢Ù†.", '<button class="btn" onclick="closeModal()">ØªÙ…Ø§Ù…</button>');
      }
    }

    // ================== Start app ==================
    async function startApp(){
      // hide start overlay, show onboarding then go to login
      $("startOverlay").classList.add("hidden");
      showOnboarding(()=>{
        hideAllPages();
        if(IS_STUDENT_ENTRY){
          show("studentLoginPage");
          currentAccess="student";
        }else{
          show("teacherLoginPage");
          currentAccess="teacher";
        }
      });
    }

    // ================== DOMContentLoaded ==================
    document.addEventListener("DOMContentLoaded", async()=>{
      // mode pill
      $("modePill").textContent = IS_STUDENT_ENTRY ? "ÙˆØ¶Ø¹: Ø§Ù„Ø·Ø§Ù„Ø¨" : "ÙˆØ¶Ø¹: Ø§Ù„Ù…Ø¹Ù„Ù…Ø©";
      if(IS_STUDENT_ENTRY){
        $("startMsg").innerHTML = "Ø¨ÙˆØ§Ø¨Ø© Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø·Ù„Ø§Ø¨ ğŸ‘‡<br>Ø§Ø¶ØºØ· Ø²Ø± Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© Ø«Ù… ØªØ§Ø¨Ø¹ÙŠ Ø§Ù„ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø³Ø±ÙŠØ¹.";
      }

      // forgot pin handler
      const f = $("forgotPinLink");
      if(f) f.addEventListener("click",(e)=>{ e.preventDefault(); forgotStudentPin(); });

      const opSel = $("op");
      if(opSel) opSel.addEventListener("change", ()=> setupReasonUI(opSel.value, "reasonStudent", "reasonOtherStudent"));

      await loadForgotSetting();

      try{
        await ensureSeed();
        await renderTabs();
        $("connPill").textContent="Ø¬Ø§Ù‡Ø² âœ…";
      }catch(e){
        console.log(e);
        $("connPill").textContent="Ø¬Ø§Ù‡Ø² âœ…";
      }

      initTeacherReasonAlways();
      // keep start overlay visible until user presses start
      // public footer visible always (under start overlay it's behind)
    });
  </script>
</body>
</html>
"""
path.write_text(html, encoding="utf-8")
str(path), path.stat().st_size
